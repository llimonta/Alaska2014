%Meteors number correspond to Glenn numbers in MeteorsToAnalyze in
%ursiMultipleMassPlot

clc
close all 
AllMeteorBoloPower=[];
AllMeteorQ=[];
AllMeteorSpeed=[];
AllMeteorBoloError=[];
AllMeteorQError=[];
MeteorSpeedForHist=[];

amu      = 1.6604e-27;   
Mass_H   = 1;
Mass_O   = 16;
Mass_Fe  = 56;
Mass_Si  = 28;
Mass_Mg  = 24;
Mass_H   = Mass_H*amu;
Mass_O   = Mass_O*amu;
Mass_Fe  = Mass_Fe*amu;
Mass_Mg  = Mass_Mg*amu;
Mass_Si  = Mass_Si*amu;
% avgmass  = ((Mass_O*.617)+(Mass_Si*.242)+(Mass_Mg*.082)+(Mass_Fe*.059))
avgmass  = ((Mass_O*.45)+(Mass_Si*.31)+(Mass_Mg*.09)+(Mass_Fe*.15))
mu = avgmass;
muSugar = 40*1.66*10^-27

%Mean error variance with magnitude
fittedmodel=load('FittedModelForMeanErrorVarianceManualAutomatic.mat');
% Out of sample Error Variance due to v-mag fitting
oosev=0.05; %this should be done in-frame

colorquiver=colormap(jet(60));

%%
%Data Meteor 1:= 2014/03/30, 10:56:33.08-1056:34.04, 4th meteor first day
%From Glenn
%Z location:
meteorZ=[98.9349;   98.7535;   98.5498;   98.3278;   97.8422;   97.3176;   96.7682;   96.4871];
MeteorSpeedAndAcc=[66.7191   85.3276
   66.4967   81.5070
   66.2333   76.2456
   65.8769   69.8131
   64.5826   66.5129
   61.7083  135.1779
   55.8612  329.5333
   51.5795  497.7959]; %first column speed, second column acc.
GlennMeteorTimes=[7.356884559471087e+05;7.356884559473271e+05;7.356884559475454e+05;7.356884559477638e+05;
                  7.356884559482005e+05;7.356884559486373e+05;7.356884559490740e+05;7.356884559492924e+05];
qmeteor=[2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     6.006357845995829e+14
     6.006357845995829e+14
     6.006357845995829e+14
     3.231471037416355e+16
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     6.006357845995829e+14
     2.363974366719033e+14
     2.363974366719033e+14
     6.006357845995829e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14
     6.006357845995829e+14
     3.231471037416355e+16
     2.363974366719033e+14
     2.363974366719033e+14
     6.006357845995829e+14
     6.006357845995829e+14
     6.006357845995829e+14
     6.006357845995829e+14
     3.231471037416355e+16
     3.231471037416355e+16
     1.561675758916593e+16
     1.561675758916593e+16
     3.231471037416355e+16
     1.131684738244867e+15
     3.231471037416355e+16
     1.561675758916593e+16
     6.006357845995829e+14
     3.231471037416355e+16
     3.231471037416355e+16
     6.006357845995829e+14
     6.006357845995829e+14
     2.363974366719033e+14
     2.363974366719033e+14
     2.363974366719033e+14];
 radarTime=[7.356884559466590e+05
     7.356884559466937e+05
     7.356884559467284e+05
     7.356884559467630e+05
     7.356884559467979e+05
     7.356884559468325e+05
     7.356884559468672e+05
     7.356884559469020e+05
     7.356884559469367e+05
     7.356884559469714e+05
     7.356884559470061e+05
     7.356884559470409e+05
     7.356884559470756e+05
     7.356884559471103e+05
     7.356884559471450e+05
     7.356884559471798e+05
     7.356884559472145e+05
     7.356884559472492e+05
     7.356884559472839e+05
     7.356884559473187e+05
     7.356884559473534e+05
     7.356884559473881e+05
     7.356884559474228e+05
     7.356884559474576e+05
     7.356884559474923e+05
     7.356884559475270e+05
     7.356884559475617e+05
     7.356884559475965e+05
     7.356884559476312e+05
     7.356884559476658e+05
     7.356884559477007e+05
     7.356884559477353e+05
     7.356884559477700e+05
     7.356884559478047e+05
     7.356884559478395e+05
     7.356884559478742e+05
     7.356884559479089e+05
     7.356884559479436e+05
     7.356884559479784e+05
     7.356884559480131e+05
     7.356884559480478e+05
     7.356884559480825e+05
     7.356884559481173e+05
     7.356884559481520e+05
     7.356884559481867e+05];



%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor4Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;

OpticalTime=OpticalMeteor.meteor_time;

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);


AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));
figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on
%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s

figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower));set(gca,'xdir','reverse');hold on;
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal','LineWidth',2);hold on;figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
P1=[1, AltitudeMeteor(1)];
P2=[1, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

%pause
% %clear all
%%
%Data Meteor 2:=2014/03/30, 10:57:54.09, 5th meteor First day;

meteorZ =[ 99.1266442610413
          98.9866666172511
          98.8441491576777
          98.6991524447531
          98.5515042726547
          98.4012636422776
          98.2484128084561
          98.0929339279173
          97.9348090587901
          97.7740201601246
          97.6106369471818
          97.2755781347732
          96.7524144192175
          96.5724652324334
          96.3898022442863
          96.2042116673765
          96.0157711113643
          95.8244614121268
          95.6302633003215
          95.4331574008866
          95.2331242324835
          95.0302531937923];
GlennMeteorTimes=[7.356884568760919e+05
     7.356884568763103e+05
     7.356884568765287e+05
     7.356884568767470e+05
     7.356884568769654e+05
     7.356884568771838e+05
     7.356884568774021e+05
     7.356884568776205e+05
     7.356884568778389e+05
     7.356884568780573e+05
     7.356884568782756e+05
     7.356884568787124e+05
     7.356884568793676e+05
     7.356884568795860e+05
     7.356884568798043e+05
     7.356884568800227e+05
     7.356884568802411e+05
     7.356884568804594e+05
     7.356884568806778e+05
     7.356884568808962e+05
     7.356884568811146e+05
     7.356884568813329e+05];   
 MeteorSpeedAndAcc=[     2.862405477368067e+01     7.361698935419714e+00
     2.858955951486021e+01     7.445381763457945e+00
     2.855621148407348e+01     7.530942832660833e+00
     2.852404478064452e+01     7.618362146599241e+00
     2.849304247901869e+01     7.707760358869626e+00
     2.846323957203211e+01     7.799119063939278e+00
     2.843465371282542e+01     7.892466270087002e+00
     2.840730267786199e+01     7.987830297290057e+00
     2.838120436224923e+01     8.085239788736640e+00
     2.835637677488836e+01     8.184723722565765e+00
     2.833285023418126e+01     8.286256706931990e+00
     2.828971085875828e+01     8.495860212937655e+00
     2.823512666430072e+01     8.826798040619943e+00
     2.821970612511959e+01     8.941643923731695e+00
     2.820571091030407e+01     9.058746508889891e+00
     2.819314486710071e+01     9.178263242146388e+00
     2.818203467825927e+01     9.300165302701229e+00
     2.817239923111277e+01     9.424486178498062e+00
     2.816425745442258e+01     9.551259846127593e+00
     2.815762831127085e+01     9.680520784379336e+00
     2.815253079184153e+01     9.812303987871134e+00
     2.814898538026933e+01     9.946572682685060e+00];
 radarTime=[ 7.356884568795545e+05
     7.356884568795892e+05
     7.356884568796239e+05
     7.356884568796587e+05
     7.356884568796934e+05
     7.356884568797281e+05
     7.356884568797628e+05
     7.356884568797976e+05
     7.356884568798323e+05
     7.356884568798670e+05
     7.356884568799018e+05
     7.356884568799365e+05
     7.356884568799712e+05
     7.356884568800059e+05
     7.356884568800407e+05
     7.356884568800754e+05
     7.356884568801101e+05
     7.356884568801448e+05
     7.356884568801796e+05
     7.356884568802143e+05
     7.356884568802490e+05
     7.356884568802837e+05
     7.356884568803185e+05
     7.356884568803532e+05
     7.356884568803879e+05
     7.356884568804225e+05
     7.356884568804574e+05
     7.356884568804920e+05
     7.356884568805267e+05
     7.356884568805615e+05
     7.356884568805962e+05
     7.356884568806309e+05
     7.356884568806656e+05
     7.356884568807004e+05
     7.356884568807351e+05
     7.356884568807698e+05
     7.356884568808045e+05
     7.356884568808393e+05
     7.356884568808740e+05
     7.356884568809087e+05
     7.356884568809434e+05
     7.356884568809782e+05
     7.356884568810129e+05
     7.356884568810476e+05
     7.356884568810823e+05
     7.356884568811171e+05
     7.356884568811518e+05
     7.356884568811865e+05
     7.356884568812212e+05
     7.356884568812560e+05
     7.356884568812907e+05
     7.356884568813253e+05
     7.356884568813602e+05
     7.356884568813948e+05
     7.356884568814295e+05
     7.356884568814642e+05
     7.356884568814990e+05
     7.356884568815337e+05
     7.356884568815684e+05
     7.356884568816031e+05
     7.356884568816379e+05
     7.356884568816726e+05
     7.356884568817073e+05
     7.356884568817420e+05
     7.356884568817768e+05
     7.356884568818115e+05
     7.356884568818462e+05
     7.356884568818809e+05
     7.356884568819157e+05
     7.356884568819504e+05
     7.356884568819851e+05
     7.356884568820199e+05
     7.356884568820546e+05
     7.356884568820893e+05];
 qmeteor=[ 3.450273626341654e+14
     3.288319553566419e+14
     8.354923060404155e+14
     3.074027373853490e+16
     7.953323210690269e+14
     7.953323210690269e+14
     2.922628604898471e+16
     1.424717595815886e+15
     7.179796885430855e+14
     1.352777634512216e+15
     2.775052840158239e+16
     1.282701304244169e+15
     2.956190183954675e+16
     1.214488605011745e+15
     1.214488605011745e+15
     5.020593290982536e+16
     1.856146037363346e+15
     2.733388584941477e+15
     2.733388584941477e+15
     2.787901434568908e+16
     2.787901434568908e+16
     4.479734498962046e+16
     2.430782954943609e+15
     6.191178299013610e+16
     2.213105197164883e+16
     3.161382834811762e+15
     2.286135290694179e+15
     2.573845780458155e+16
     4.382135766448705e+16
     2.573845780458155e+16
     4.104874986601070e+16
     2.172243749226510e+16
     2.010150263694329e+15
     3.836674412296970e+16
     2.030315670302616e+16
     2.488255404364359e+16
     1.893182128343402e+16
     2.422632428100221e+15
     3.577534043536408e+16
     2.253283288256600e+15
     2.978004384307766e+15
     2.253283288256600e+15
     2.978004384307766e+15
     2.762296363558754e+15
     4.696935418026066e+16
     4.696935418026066e+16
     1.676574321466830e+16
     2.554697044778826e+15
     1.676574321466830e+16
     1.676574321466830e+16
     2.052710039843282e+16
     2.052710039843282e+16
     3.057378180853141e+16
     1.706694151318549e+16
     1.723294017016650e+16
     1.637240576219180e+15
     1.183960834934440e+15
     1.083680842348372e+15
     7.358887471663932e+14
     2.415908243436551e+14
     2.415908243436551e+14
     6.708050543277602e+14
     6.708050543277602e+14
     9.878376169286404e+14
     6.708050543277602e+14
     6.087342107561021e+14
     1.998462408197390e+14
     3.765392381376006e+14
     6.087342107561021e+14
     5.496762164514189e+14
     3.400082665107571e+14
     1.804576177661985e+14
     1.804576177661985e+14
     3.400082665107571e+14];
 
 
 %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor5Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times
[C,ia,ib] =intersect(OpticalTime,GlennMeteorTimes);    %ia common elements in OpticalTime,ib common elements in GlennMeteorTimes
%if there are holes in the radar data, we need to fit them 

if sum(ia)~=sum(ib)
    % Fitting missing values
    time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
    time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
    % fit range exponential
    fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
    tempZ = feval(fz,time_for_eval);
    % fit velocity exponential (using range)
    velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
    tempVel=feval(velFit,time_for_eval);
    % fit deceleration exponential (again using range)
    accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
    temAcc = feval(accFit,time_for_eval);
end

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on
%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power','FontSize',20);ylabel('Electron Line Density [e/m]');title('q vs I','FontSize',20,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed [km/s]','FontSize',15);hold on;
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
% %clear all
%pause
%clear all
P1=[2, AltitudeMeteor(1)];
P2=[2, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})


%%
%Meteor 3:= 2014/03/30 11 0 15.3774, 7th meteor first day
meteorZ =[9.665539415623061e+01
     9.647466186201200e+01
     9.627963643614203e+01
     9.607055571232922e+01
     9.584795619384386e+01
     9.561226458312012e+01
     9.536389818228781e+01
     9.510326507198624e+01
     9.483076429273933e+01
     9.454694037837908e+01
     9.425187189318240e+01
     9.394608013657853e+01
     9.362992969981860e+01
     9.330377697211225e+01];
 
 GlennMeteorTimes=[7.356884585113120e+05
     7.356884585115304e+05
     7.356884585117487e+05
     7.356884585119671e+05
     7.356884585121855e+05
     7.356884585124039e+05
     7.356884585126223e+05
     7.356884585128407e+05
     7.356884585130591e+05
     7.356884585132773e+05
     7.356884585134957e+05
     7.356884585137141e+05
     7.356884585139325e+05
     7.356884585141509e+05];
 MeteorSpeedAndAcc=[6.062989907409561e+01     2.901374382799969e+01
     6.047124174925613e+01     3.009903826192228e+01
     6.031836072401090e+01     3.125211877631842e+01
     6.017033695304850e+01     3.247665979383751e+01
     6.002654838848834e+01     3.377459697348309e+01
     5.988634089763974e+01     3.514856083430212e+01
     5.974911091404086e+01     3.660129182084236e+01
     5.961430517896041e+01     3.813565174602447e+01
     5.948142058091631e+01     3.975463505305328e+01
     5.935007384533986e+01     4.146044615600756e+01
     5.921972222297507e+01     4.325819583669432e+01
     5.909008372532815e+01     4.515045603674893e+01
     5.896085682721868e+01     4.714086080900622e+01
     5.883179148541011e+01     4.923323083721051e+01];
 
 radarTime=[7.356884585135513e+05
     7.356884585135860e+05
     7.356884585136207e+05
     7.356884585136554e+05
     7.356884585136902e+05
     7.356884585137249e+05
     7.356884585137595e+05
     7.356884585137942e+05
     7.356884585138290e+05
     7.356884585138637e+05
     7.356884585138984e+05
     7.356884585139332e+05
     7.356884585139679e+05
     7.356884585140026e+05
     7.356884585140373e+05
     7.356884585140721e+05
     7.356884585141068e+05
     7.356884585141415e+05
     7.356884585141762e+05
     7.356884585142110e+05
     7.356884585142457e+05
     7.356884585142804e+05
     7.356884585143151e+05
     7.356884585143499e+05
     7.356884585143846e+05
     7.356884585144193e+05
     7.356884585144540e+05
     7.356884585144888e+05
     7.356884585145235e+05
     7.356884585145582e+05
     7.356884585145928e+05
     7.356884585146277e+05
     7.356884585146623e+05
     7.356884585146970e+05
     7.356884585147318e+05
     7.356884585147665e+05
     7.356884585148012e+05
     7.356884585148359e+05
     7.356884585148707e+05
     7.356884585149054e+05
     7.356884585149401e+05
     7.356884585149748e+05
     7.356884585150096e+05
     7.356884585150443e+05
     7.356884585150790e+05
     7.356884585151137e+05
     7.356884585151485e+05
     7.356884585151832e+05
     7.356884585152179e+05
     7.356884585152526e+05
     7.356884585152874e+05
     7.356884585153221e+05
     7.356884585153568e+05
     7.356884585153916e+05
     7.356884585154263e+05
     7.356884585154610e+05
     7.356884585154956e+05
     7.356884585155305e+05
     7.356884585155651e+05
     7.356884585155998e+05
     7.356884585156345e+05
     7.356884585156693e+05
     7.356884585157040e+05
     7.356884585157387e+05
     7.356884585157734e+05
     7.356884585158082e+05
     7.356884585158429e+05
     7.356884585158776e+05
     7.356884585159124e+05
     7.356884585159471e+05
     7.356884585159818e+05
     7.356884585160165e+05
     7.356884585160513e+05
     7.356884585160860e+05
     7.356884585161207e+05
     7.356884585161554e+05
     7.356884585161902e+05
     7.356884585162249e+05
     7.356884585162596e+05
     7.356884585162943e+05
     7.356884585163291e+05
     7.356884585163638e+05
     7.356884585163984e+05
     7.356884585164331e+05
     7.356884585164679e+05];
 
 qmeteor=[5.909933727438019e+14
     5.909933727438019e+14
     9.742420006336856e+13
     5.909933727438019e+14
     5.909933727438019e+14
     1.447581345645806e+15
     1.394562898534797e+15
     5.283925821412766e+14
     3.866663938749045e+16
     3.716813517770763e+16
     3.716813517770763e+16
     7.083487811992349e+16
     1.144307350063931e+15
     1.097223577786594e+15
     4.137019275136918e+14
     6.568271164353891e+16
     3.064360080140048e+15
     6.280237391558465e+16
     9.187796134000276e+14
     8.766414034840821e+14
     6.263632475787443e+16
     2.853733055226658e+16
     5.682676332069706e+16
     7.953323210690269e+14
     7.476253576001232e+16
     6.074487730698388e+16
     7.128329884768589e+15
     7.244978890730422e+16
     1.439935070896910e+16
     1.361269573482068e+16
     1.361269573482068e+16
     4.109421710502406e+16
     1.210567313602216e+16
     1.210567313602216e+16
     1.325136552610791e+16
     2.842011552655136e+16
     1.243864641208409e+16
     1.165164459646980e+16
     1.530659016052848e+16
     4.785316449818769e+16
     1.089036007926505e+16
     1.169326143269218e+16
     8.540725649845506e+16
     5.757485380881090e+15
     1.008808813921237e+16
     1.008808813921237e+16
     3.316344126207083e+16
     2.427222551162195e+16
     9.812828497047448e+15
     9.812828497047448e+15
     1.096004022097137e+17
     1.723294017016650e+16
     6.862716242636815e+15
     8.251850032423823e+15
     8.251850032423823e+15
     2.694502384130544e+16
     2.343637530966395e+16
     7.724227955628077e+15
     7.724227955628077e+15
     1.638330980415451e+15
     4.691966319742053e+15
     7.836033974525477e+15
     4.851935498132140e+15
     1.328545468453693e+15
     4.851935498132140e+15
     7.011526064610497e+15
     1.126645828024552e+16
     2.292581223129412e+15
     5.567992213017269e+15
     2.864450027560946e+15
     1.342622863225715e+15
     4.359594144143818e+15
     1.468716961487244e+15
     1.033187954111001e+16
     1.123641333251986e+16
     1.853078739108760e+14
     8.062788681591898e+14
     2.585980852297953e+14
     5.266107274850496e+14
     1.599586884977671e+14
     2.585980852297953e+14
     2.206300357939371e+14
     1.364731341202805e+14
     1.364731341202805e+14
     2.206300357939371e+14];
 
%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor7Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on
%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%pause
%clear all
 AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
P1=[3, AltitudeMeteor(1)];
P2=[3, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})



%%
%Meteor 5:= 2014/03/30 11:24:39.49, meteor eleven fist day

meteorZ =[1.038034132478664e+02
     1.034483418181114e+02
     1.030932851653032e+02
     1.027382388655778e+02
     1.023831984791322e+02
     1.020281595501107e+02
     1.016731176064900e+02
     1.013182574215289e+02
     1.009631959749979e+02
     1.002530189648552e+02
     9.989789430881152e+01
     9.954273946246462e+01
     9.918754983737000e+01
     9.847723720199569e+01
     9.812191556549968e+01
     9.776654062669996e+01
     9.705561212378080e+01
     9.670004915604954e+01
     9.634460366953085e+01
     9.563309826691064e+01
     9.527721835381000e+01
     9.456518009501659e+01
     9.314004428230592e+01
     9.278342411867054e+01
     9.171279174136711e+01
     9.135583082483583e+01
     9.064108745378144e+01
     9.028348525342463e+01
     8.992572261797082e+01
     8.956779445297866e+01
     8.920969564341385e+01
     8.885161207917574e+01
     8.849315665011969e+01
     8.813451510919963e+01
     8.777568225762029e+01
     8.741665287528943e+01
     8.705742172067448e+01
     8.669798353065875e+01
     8.633852478925542e+01
     8.597865676944954e+01
     8.561856579678181e+01
     8.525824652035467e+01
     8.489769356695444e+01];
 
MeteorSpeedAndAcc=[2.028427350176156e+01     1.252318266698021e+00
     2.034118610272906e+01     1.247491963135645e+00
     2.039314516125177e+01     1.242686774448727e+00
     2.043990205611951e+01     1.237902619552925e+00
     2.048142153998102e+01     1.233139417709606e+00
     2.051781851780706e+01     1.228397088524351e+00
     2.054931026269517e+01     1.223675551945482e+00
     2.057616742461810e+01     1.218977228528687e+00
     2.059874217829575e+01     1.214297027393515e+00
     2.063237980575349e+01     1.204998210032664e+00
     2.064413877699874e+01     1.200379436751082e+00
     2.065297490944586e+01     1.195780982922318e+00
     2.065920758216375e+01     1.191202770852534e+00
     2.066504504818671e+01     1.182109176486364e+00
     2.066519159500793e+01     1.177591216187303e+00
     2.066381460063628e+01     1.173093190208400e+00
     2.065734448337063e+01     1.164156637321933e+00
     2.065263071465479e+01     1.159717959278014e+00
     2.064715737960879e+01     1.155301263630583e+00
     2.063448939677862e+01     1.146521748247836e+00
     2.062754749009546e+01     1.142161140729380e+00
     2.061297678585873e+01     1.133497856955857e+00
     2.058338331420654e+01     1.116403225432880e+00
     2.057626465149451e+01     1.112176419656918e+00
     2.055633585534553e+01     1.099608679015090e+00
     2.055028802454355e+01     1.095458962459840e+00
     2.053923855461632e+01     1.087210653238938e+00
     2.053428293951131e+01     1.083114138726904e+00
     2.052973039306914e+01     1.079035958119297e+00
     2.052559552944684e+01     1.074976042163971e+00
     2.052189080323150e+01     1.070934321902157e+00
     2.051862838060533e+01     1.066912868623061e+00
     2.051581363780420e+01     1.062907324430755e+00
     2.051345580746782e+01     1.058919770838682e+00
     2.051156095580429e+01     1.054950140047992e+00
     2.051013399943372e+01     1.050998364546518e+00
     2.050917884655349e+01     1.047064377107441e+00
     2.050869852250944e+01     1.043148110787965e+00
     2.050869515574669e+01     1.039251572388260e+00
     2.050917032415797e+01     1.035370539251385e+00
     2.051012515509461e+01     1.031507028131787e+00
     2.051156014073515e+01     1.027660973209398e+00
     2.051347533641026e+01     1.023832308941585e+00];


GlennMeteorTimes=[ 7.356884754570667e+05
     7.356884754572851e+05
     7.356884754575035e+05
     7.356884754577219e+05
     7.356884754579403e+05
     7.356884754581586e+05
     7.356884754583770e+05
     7.356884754585953e+05
     7.356884754588137e+05
     7.356884754592505e+05
     7.356884754594689e+05
     7.356884754596873e+05
     7.356884754599057e+05
     7.356884754603424e+05
     7.356884754605608e+05
     7.356884754607792e+05
     7.356884754612159e+05
     7.356884754614343e+05
     7.356884754616526e+05
     7.356884754620894e+05
     7.356884754623078e+05
     7.356884754627446e+05
     7.356884754636181e+05
     7.356884754638365e+05
     7.356884754644916e+05
     7.356884754647099e+05
     7.356884754651467e+05
     7.356884754653651e+05
     7.356884754655835e+05
     7.356884754658019e+05
     7.356884754660203e+05
     7.356884754662386e+05
     7.356884754664570e+05
     7.356884754666754e+05
     7.356884754668938e+05
     7.356884754671121e+05
     7.356884754673305e+05
     7.356884754675489e+05
     7.356884754677672e+05
     7.356884754679856e+05
     7.356884754682040e+05
     7.356884754684224e+05
     7.356884754686408e+05];
 
 radarTime=[7.356884754625126e+05
     7.356884754625473e+05
     7.356884754625821e+05
     7.356884754626168e+05
     7.356884754626515e+05
     7.356884754626862e+05
     7.356884754627210e+05
     7.356884754627557e+05
     7.356884754627903e+05
     7.356884754628250e+05
     7.356884754628598e+05
     7.356884754628945e+05
     7.356884754629292e+05
     7.356884754629639e+05
     7.356884754629987e+05
     7.356884754630334e+05
     7.356884754630681e+05
     7.356884754631029e+05
     7.356884754631376e+05
     7.356884754631723e+05
     7.356884754632070e+05
     7.356884754632418e+05
     7.356884754632765e+05
     7.356884754633112e+05
     7.356884754633459e+05
     7.356884754633807e+05
     7.356884754634154e+05
     7.356884754634501e+05
     7.356884754634848e+05
     7.356884754635196e+05
     7.356884754635543e+05
     7.356884754635890e+05
     7.356884754636238e+05
     7.356884754636585e+05
     7.356884754636931e+05
     7.356884754637278e+05
     7.356884754637626e+05
     7.356884754637973e+05
     7.356884754638320e+05
     7.356884754638667e+05
     7.356884754639015e+05
     7.356884754639362e+05
     7.356884754639709e+05
     7.356884754640056e+05
     7.356884754640404e+05
     7.356884754640751e+05
     7.356884754641098e+05
     7.356884754641445e+05
     7.356884754641793e+05
     7.356884754642140e+05
     7.356884754642487e+05
     7.356884754642835e+05
     7.356884754643182e+05
     7.356884754643529e+05
     7.356884754643876e+05
     7.356884754644224e+05
     7.356884754644571e+05
     7.356884754644918e+05
     7.356884754645264e+05
     7.356884754645613e+05
     7.356884754645959e+05
     7.356884754646306e+05
     7.356884754646653e+05
     7.356884754647001e+05
     7.356884754647348e+05
     7.356884754647695e+05
     7.356884754648042e+05
     7.356884754648390e+05
     7.356884754648737e+05
     7.356884754649084e+05
     7.356884754649431e+05
     7.356884754649779e+05
     7.356884754650126e+05
     7.356884754650473e+05
     7.356884754650821e+05
     7.356884754651168e+05
     7.356884754651515e+05
     7.356884754651862e+05
     7.356884754652209e+05
     7.356884754652557e+05
     7.356884754652904e+05
     7.356884754653251e+05
     7.356884754653597e+05
     7.356884754653946e+05
     7.356884754654292e+05
     7.356884754654639e+05
     7.356884754654986e+05
     7.356884754655334e+05
     7.356884754655681e+05
     7.356884754656028e+05
     7.356884754656376e+05
     7.356884754656723e+05
     7.356884754657070e+05
     7.356884754657417e+05
     7.356884754657765e+05
     7.356884754658112e+05
     7.356884754658459e+05
     7.356884754658806e+05
     7.356884754659154e+05
     7.356884754659501e+05
     7.356884754659848e+05
     7.356884754660195e+05
     7.356884754660543e+05
     7.356884754660890e+05
     7.356884754661237e+05
     7.356884754661584e+05
     7.356884754661932e+05
     7.356884754662279e+05
     7.356884754662625e+05
     7.356884754662972e+05
     7.356884754663320e+05
     7.356884754663667e+05
     7.356884754664014e+05
     7.356884754664362e+05
     7.356884754664709e+05
     7.356884754665056e+05
     7.356884754665403e+05
     7.356884754665751e+05
     7.356884754666098e+05
     7.356884754666445e+05
     7.356884754666792e+05
     7.356884754667140e+05
     7.356884754667487e+05
     7.356884754667834e+05
     7.356884754668181e+05
     7.356884754668529e+05
     7.356884754668876e+05
     7.356884754669223e+05
     7.356884754669571e+05
     7.356884754669918e+05
     7.356884754670265e+05
     7.356884754670612e+05
     7.356884754670960e+05
     7.356884754671307e+05
     7.356884754671653e+05
     7.356884754672000e+05
     7.356884754672348e+05
     7.356884754672695e+05
     7.356884754673042e+05
     7.356884754673389e+05
     7.356884754673737e+05
     7.356884754674084e+05
     7.356884754674431e+05
     7.356884754674778e+05
     7.356884754675126e+05
     7.356884754675473e+05
     7.356884754675820e+05
     7.356884754676168e+05
     7.356884754676515e+05
     7.356884754676862e+05
     7.356884754677209e+05
     7.356884754677557e+05
     7.356884754677904e+05
     7.356884754678251e+05
     7.356884754678598e+05
     7.356884754678946e+05
     7.356884754679293e+05
     7.356884754679640e+05
     7.356884754679987e+05
     7.356884754680335e+05
     7.356884754680682e+05
     7.356884754681028e+05
     7.356884754681375e+05
     7.356884754681723e+05
     7.356884754682070e+05
     7.356884754682417e+05
     7.356884754682765e+05
     7.356884754683112e+05];
 qmeteor=[1.853078739108760e+14
     9.835118958267389e+13
     1.599586884977671e+14
     1.599586884977671e+14
     1.599586884977671e+14
     1.599586884977671e+14
     1.364731341202805e+14
     1.364731341202805e+14
     1.364731341202805e+14
     2.206300357939371e+14
     1.148512107784163e+14
     1.148512107784163e+14
     1.856748356250538e+14
     1.148512107784163e+14
     2.734275568798138e+14
     3.130617751720778e+14
     9.509291847217459e+13
     1.537324847231456e+14
     1.537324847231456e+14
     9.509291847217459e+13
     1.248029830882123e+14
     1.837867508660826e+14
     2.541495605351658e+14
     1.837867508660826e+14
     2.541495605351658e+14
     2.661400267899702e+14
     2.013727306319600e+14
     3.399233870827518e+14
     2.013727306319600e+14
     2.661400267899702e+14
     2.661400267899702e+14
     2.013727306319600e+14
     2.044973434535626e+14
     2.044973434535626e+14
     2.044973434535626e+14
     2.044973434535626e+14
     2.611911874910034e+14
     2.611911874910034e+14
     2.044973434535626e+14
     2.397822590831283e+14
     1.928157067717267e+14
     2.918630190204438e+14
     1.509633620862395e+14
     2.397822590831283e+14
     3.490579865836735e+14
     2.918630190204438e+14
     1.928157067717267e+14
     1.928157067717267e+14
     2.040406560192586e+14
     2.040406560192586e+14
     2.040406560192586e+14
     1.676311360353410e+14
     2.440255048766747e+14
     2.040406560192586e+14
     1.676311360353410e+14
     2.440255048766747e+14
     2.440255048766747e+14
     1.055380826880009e+14
     8.713490195058816e+13
     2.163691322456657e+14
     1.577419907603606e+14
     2.163691322456657e+14
     2.491494276719552e+14
     2.163691322456657e+14
     2.842408728873362e+14
     2.842408728873362e+14
     3.216434678918085e+14
     3.613572126853722e+14
     2.491494276719552e+14
     2.163691322456657e+14
     3.216434678918085e+14
     4.026319173341499e+14
     3.107089064131208e+14
     1.237343736888656e+14
     2.306809288463282e+14
     2.066482770694498e+14
     1.063100737754519e+14
     1.063100737754519e+14
     2.066482770694498e+14
     3.107089064131208e+14
     2.306809288463282e+14
     4.359162617198786e+14
     4.359162617198786e+14
     4.359162617198786e+14
     5.436993171132229e+14
     3.400282396807709e+14
     2.066482770694498e+14
     2.560352509958995e+14
     1.839372956652643e+14
     2.496583299538688e+14
     1.298166370535059e+14
     1.848823585092623e+14
     2.673695493757782e+14
     4.309073672259656e+14
     9.073894878220269e+14
     4.778607279315437e+14
     5.790501368343371e+14
     6.899497957259808e+14
     5.528424486721842e+14
     6.058647156207935e+14
     4.083410228096314e+14
     1.561357165327779e+14
     1.298166370535059e+14
     3.046126600925062e+14
     4.309073672259656e+14
     3.241445513873251e+14
     4.540806022666033e+14
     5.272416511343343e+14
     5.528424486721842e+14
     2.496583299538688e+14
     3.046126600925062e+14
     1.426727314809903e+14
     2.160565629829594e+14
     1.426727314809903e+14
     4.540806022666033e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.058821251167672e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.817695554165566e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.314959897122752e+14
     2.314959897122752e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.314959897122752e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];


%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor11Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on
%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%pause
%clear all
 AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

P1=[4, AltitudeMeteor(1)];
P2=[4, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
%Meteor 6:= 2014/03/30 11:48:21.67, 18th meteor first day
meteorZ =[ 8.480920350686944e+01
     8.459224258343859e+01
     8.437779312065881e+01
     8.416602027116183e+01
     8.395675289259025e+01
     8.375016132695117e+01
     8.354630428279870e+01
     8.334524253572951e+01
     8.314703899735498e+01
     8.275957099407941e+01
     8.257034034490515e+01
     8.238424233391677e+01
     8.184550430912873e+01
     8.167271038630244e+01
     8.150353880770035e+01
     8.133789769647119e+01
     8.117596990390572e+01
     8.101785027520417e+01
     8.086363692959486e+01
     8.071343136977930e+01
     8.056733859504705e+01
     8.042554169830109e+01
     8.028800172570799e+01];
 
 MeteorSpeedAndAcc=[     2.455888238779135e+01     2.541712553072575e+01
     2.470976902101801e+01     2.612081902602742e+01
     2.484572539771348e+01     2.686971166001554e+01
     2.496476389457077e+01     2.766426964199080e+01
     2.506495692033888e+01     2.850628569173888e+01
     2.514404770948581e+01     2.939634410419738e+01
     2.519970754199402e+01     3.033549711361334e+01
     2.522946033907770e+01     3.132485949115020e+01
     2.523067513128636e+01     3.236561408182363e+01
     2.513618940522673e+01     3.460577562326229e+01
     2.503435809438091e+01     3.580852890470650e+01
     2.489175895548288e+01     3.706818197028144e+01
     2.418307343623979e+01     4.120493430586093e+01
     2.384007576308128e+01     4.270906218230250e+01
     2.343680991521407e+01     4.427816563941160e+01
     2.296824208008270e+01     4.591601046910755e+01
     2.242974040191750e+01     4.762398025816901e+01
     2.181625626171165e+01     4.940439065077034e+01
     2.112253842854995e+01     5.125967347865477e+01
     2.034316312683119e+01     5.319238010965922e+01
     1.947258770056981e+01     5.520518490894784e+01
     1.850578619386737e+01     5.729974912315491e+01
     1.743629724914937e+01     5.948123691164294e+01];
 
 GlennMeteorTimes=[ 7.356884919175839e+05
     7.356884919178023e+05
     7.356884919180206e+05
     7.356884919182389e+05
     7.356884919184573e+05
     7.356884919186757e+05
     7.356884919188941e+05
     7.356884919191125e+05
     7.356884919193309e+05
     7.356884919197676e+05
     7.356884919199860e+05
     7.356884919202044e+05
     7.356884919208596e+05
     7.356884919210779e+05
     7.356884919212962e+05
     7.356884919215146e+05
     7.356884919217330e+05
     7.356884919219514e+05
     7.356884919221698e+05
     7.356884919223882e+05
     7.356884919226066e+05
     7.356884919228249e+05
     7.356884919230433e+05];
 radarTime=[7.356884919185560e+05
     7.356884919185909e+05
     7.356884919186255e+05
     7.356884919186602e+05
     7.356884919186949e+05
     7.356884919187297e+05
     7.356884919187644e+05
     7.356884919187991e+05
     7.356884919188338e+05
     7.356884919188686e+05
     7.356884919189033e+05
     7.356884919189380e+05
     7.356884919189727e+05
     7.356884919190075e+05
     7.356884919190422e+05
     7.356884919190769e+05
     7.356884919191116e+05
     7.356884919191464e+05
     7.356884919191811e+05
     7.356884919192158e+05
     7.356884919192505e+05
     7.356884919192853e+05
     7.356884919193200e+05
     7.356884919193547e+05
     7.356884919193895e+05
     7.356884919194242e+05
     7.356884919194588e+05
     7.356884919194935e+05
     7.356884919195283e+05
     7.356884919195630e+05
     7.356884919195977e+05
     7.356884919196324e+05
     7.356884919196672e+05
     7.356884919197019e+05
     7.356884919197366e+05
     7.356884919197713e+05
     7.356884919198061e+05
     7.356884919198408e+05
     7.356884919198755e+05
     7.356884919199102e+05
     7.356884919199450e+05
     7.356884919199797e+05
     7.356884919200144e+05
     7.356884919200491e+05
     7.356884919200839e+05
     7.356884919201186e+05
     7.356884919201533e+05
     7.356884919201881e+05
     7.356884919202228e+05
     7.356884919202575e+05
     7.356884919202921e+05
     7.356884919203270e+05
     7.356884919203616e+05
     7.356884919203963e+05
     7.356884919204310e+05
     7.356884919204658e+05
     7.356884919205005e+05
     7.356884919205352e+05
     7.356884919205699e+05
     7.356884919206047e+05
     7.356884919206394e+05
     7.356884919206741e+05
     7.356884919207088e+05
     7.356884919207436e+05
     7.356884919207783e+05
     7.356884919208130e+05
     7.356884919208478e+05
     7.356884919208825e+05
     7.356884919209172e+05
     7.356884919209519e+05
     7.356884919209867e+05
     7.356884919210214e+05
     7.356884919210561e+05
     7.356884919210908e+05
     7.356884919211256e+05
     7.356884919211603e+05
     7.356884919211949e+05
     7.356884919212298e+05
     7.356884919212644e+05
     7.356884919212991e+05
     7.356884919213338e+05
     7.356884919213686e+05
     7.356884919214033e+05
     7.356884919214380e+05
     7.356884919214727e+05
     7.356884919215075e+05
     7.356884919215422e+05
     7.356884919215769e+05
     7.356884919216116e+05
     7.356884919216464e+05
     7.356884919216811e+05
     7.356884919217158e+05
     7.356884919217505e+05
     7.356884919217853e+05
     7.356884919218200e+05
     7.356884919218547e+05
     7.356884919218894e+05
     7.356884919219242e+05
     7.356884919219589e+05
     7.356884919219936e+05
     7.356884919220284e+05
     7.356884919220631e+05
     7.356884919220977e+05
     7.356884919221324e+05
     7.356884919221672e+05
     7.356884919222019e+05
     7.356884919222366e+05
     7.356884919222713e+05
     7.356884919223061e+05
     7.356884919223408e+05
     7.356884919223755e+05
     7.356884919224102e+05
     7.356884919224450e+05
     7.356884919224797e+05
     7.356884919225144e+05
     7.356884919225491e+05
     7.356884919225839e+05
     7.356884919226186e+05
     7.356884919226533e+05
     7.356884919226880e+05
     7.356884919227228e+05
     7.356884919227575e+05
     7.356884919227922e+05
     7.356884919228269e+05
     7.356884919228617e+05
     7.356884919228964e+05
     7.356884919229310e+05
     7.356884919229657e+05
     7.356884919230005e+05
     7.356884919230352e+05
     7.356884919230699e+05
     7.356884919231047e+05
     7.356884919231394e+05
     7.356884919231741e+05
     7.356884919232088e+05
     7.356884919232436e+05
     7.356884919232783e+05
     7.356884919233130e+05
     7.356884919233477e+05
     7.356884919233825e+05
     7.356884919234172e+05
     7.356884919234519e+05
     7.356884919234866e+05
     7.356884919235214e+05
     7.356884919235561e+05
     7.356884919235908e+05
     7.356884919236255e+05
     7.356884919236603e+05
     7.356884919236950e+05
     7.356884919237297e+05
     7.356884919237643e+05
     7.356884919237992e+05
     7.356884919238338e+05
     7.356884919238685e+05
     7.356884919239033e+05
     7.356884919239380e+05
     7.356884919239727e+05
     7.356884919240074e+05
     7.356884919240422e+05
     7.356884919240769e+05
     7.356884919241116e+05
     7.356884919241463e+05
     7.356884919241811e+05
     7.356884919242158e+05];
 qmeteor=[1.896402681060382e+14
     2.058821251167672e+14
     1.896402681060382e+14
     2.403675656652884e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.227912243031839e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.403675656652884e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.227912243031839e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.227912243031839e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.142532694380145e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.227912243031839e+14
     1.817695554165566e+14
     2.142532694380145e+14
     2.058821251167672e+14
     2.058821251167672e+14
     1.740656532709970e+14
     2.227912243031839e+14
     1.591582806116436e+14
     1.665285616693593e+14
     2.314959897122752e+14
     1.896402681060382e+14
     1.591582806116436e+14
     1.591582806116436e+14
     1.976777913394417e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];
 
 %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor18Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%pause
%clear all
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
 

P1=[5, AltitudeMeteor(1)];
P2=[5, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
%Meteor 7:=2014/03/30 12:13:6.11  Meteor number 23, first day

meteorZ =[1.011737147356980e+02
     1.009066481275804e+02
     1.006394511385079e+02
     1.003722662554828e+02
     1.001048084349313e+02
     9.983722009428675e+01
     9.956950118713939e+01
     9.930165166705774e+01
     9.903367148760663e+01
     9.876556060231087e+01
     9.849746198548746e+01
     9.822908961881694e+01
     9.796058640686897e+01
     9.769195230312835e+01
     9.742318726105441e+01
     9.688526417573667e+01
     9.634696035767774e+01
     9.607753999542547e+01
     9.472861298347561e+01
     9.445840468469396e+01
     9.418806488810515e+01
     9.391759354699752e+01
     9.337625604425193e+01
     9.310538978909608e+01
     9.256340659788839e+01
     9.174922637531563e+01
     9.147756909894088e+01
     9.120577981004317e+01
     9.093400344433030e+01];
 MeteorSpeedAndAcc=[1.660728355420692e+01     3.868216355385890e+00
     1.657916955325417e+01     3.837740133846819e+00
     1.655150386369248e+01     3.807501050115205e+00
     1.652429656982068e+01     3.777513288740458e+00
     1.649751436172390e+01     3.747743130430244e+00
     1.647116759548875e+01     3.718204911402047e+00
     1.644525201727978e+01     3.688896925000655e+00
     1.641976339215166e+01     3.659817477656196e+00
     1.639469750434599e+01     3.630964888787021e+00
     1.637005015757756e+01     3.602337490703337e+00
     1.634582998305108e+01     3.573948709909129e+00
     1.632200699128070e+01     3.545766623571966e+00
     1.629859007359426e+01     3.517804802214558e+00
     1.627557511441574e+01     3.490061628758714e+00
     1.625295801903118e+01     3.462535498547146e+00
     1.620890114664622e+01     3.408128010780500e+00
     1.616639825402887e+01     3.354583909149973e+00
     1.614570960467962e+01     3.328119242519882e+00
     1.604780407380271e+01     3.198894265010980e+00
     1.602929906959440e+01     3.173652952062986e+00
     1.601114451321762e+01     3.148610364027797e+00
     1.599333660282134e+01     3.123765049577153e+00
     1.595874563269495e+01     3.074660491999737e+00
     1.594195508992047e+01     3.050398401851753e+00
     1.590937387669146e+01     3.002460242476543e+00
     1.586291235070169e+01     2.931946259730312e+00
     1.584805701878650e+01     2.908812819489887e+00
     1.583351166290180e+01     2.885862742419966e+00
     1.581928026280996e+01     2.863106784085213e+00];
 GlennMeteorTimes=[7.356885090985325e+05
     7.356885090987509e+05
     7.356885090989693e+05
     7.356885090991876e+05
     7.356885090994060e+05
     7.356885090996244e+05
     7.356885090998427e+05
     7.356885091000611e+05
     7.356885091002795e+05
     7.356885091004979e+05
     7.356885091007162e+05
     7.356885091009346e+05
     7.356885091011530e+05
     7.356885091013714e+05
     7.356885091015898e+05
     7.356885091020266e+05
     7.356885091024633e+05
     7.356885091026817e+05
     7.356885091037735e+05
     7.356885091039919e+05
     7.356885091042103e+05
     7.356885091044287e+05
     7.356885091048655e+05
     7.356885091050839e+05
     7.356885091055206e+05
     7.356885091061757e+05
     7.356885091063941e+05
     7.356885091066125e+05
     7.356885091068308e+05];
 qmeteor=[2.415971378439612e+14
     3.905793291392198e+14
     2.415971378439612e+14
     2.415971378439612e+14
     2.125206903596075e+14
     3.435727319024368e+14
     3.435727319024368e+14
     3.435727319024368e+14
     2.125206903596075e+14
     4.411645196479318e+14
     2.995789839326284e+14
     4.411645196479318e+14
     4.411645196479318e+14
     4.411645196479318e+14
     3.808154315588897e+14
     3.808154315588897e+14
     3.808154315588897e+14
     5.266107274850496e+14
     5.266107274850496e+14
     5.937977798264454e+14
     5.937977798264454e+14
     5.937977798264454e+14
     5.937977798264454e+14
     5.937977798264454e+14
     4.997202886136998e+14
     7.937294059800749e+14
     4.997202886136998e+14
     7.937294059800749e+14
     6.382602990928260e+14
     9.661276092754450e+14
     7.999209878579014e+14
     3.130617751720778e+14
     3.130617751720778e+14
     3.130617751720778e+14
     2.263887702897801e+14
     2.263887702897801e+14
     2.263887702897801e+14
     2.541495605351658e+14];
 radarTime=[7.356885091023329e+05
     7.356885091023676e+05
     7.356885091024023e+05
     7.356885091024369e+05
     7.356885091024718e+05
     7.356885091025064e+05
     7.356885091025411e+05
     7.356885091025758e+05
     7.356885091026106e+05
     7.356885091026453e+05
     7.356885091026800e+05
     7.356885091027147e+05
     7.356885091027495e+05
     7.356885091027842e+05
     7.356885091028189e+05
     7.356885091028536e+05
     7.356885091028884e+05
     7.356885091029231e+05
     7.356885091029578e+05
     7.356885091029926e+05
     7.356885091030273e+05
     7.356885091030620e+05
     7.356885091030967e+05
     7.356885091031315e+05
     7.356885091031662e+05
     7.356885091032009e+05
     7.356885091032356e+05
     7.356885091032704e+05
     7.356885091033051e+05
     7.356885091033397e+05
     7.356885091033744e+05
     7.356885091034092e+05
     7.356885091034439e+05
     7.356885091034786e+05
     7.356885091035133e+05
     7.356885091035481e+05
     7.356885091035828e+05
     7.356885091036175e+05];
 
  %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor23Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on


%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all

%clear all
 AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
P1=[6, AltitudeMeteor(1)];
P2=[6, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
figure(9);plot(BolometricPower,qmeteorforratio)
%pause
%%
%Meteor 9:=2014/03/30 12:39:03.66 meteor 28,first day

meteorZ =[9.692458485396378e+01
     9.596475135740550e+01
     9.548318456028075e+01
     9.500077941630920e+01
     9.451771911842451e+01
     9.258251411244314e+01
     9.209859821986784e+01
     9.161493601385192e+01
     9.064886102736835e+01
     9.016693242024901e+01
     8.968545556521840e+01
     8.920478594599578e+01
     8.872501624058461e+01];
 MeteorSpeedAndAcc=[2.842912483297554e+01     9.712742490391195e+00
     2.839254757116431e+01     9.733496875823837e+00
     2.835895885200303e+01     9.837526435227570e+00
     2.831536995082907e+01     1.002352429823128e+01
     2.826190133764199e+01     1.030820439925419e+01
     2.795126007924152e+01     1.279459363828908e+01
     2.784993123594098e+01     1.384391071351530e+01
     2.773947593400922e+01     1.509985371709612e+01
     2.749255823740966e+01     1.830542425889692e+01
     2.735728158602128e+01     2.029434679465212e+01
     2.721517323989802e+01     2.257305721754307e+01
     2.706764219827409e+01     2.516721167813562e+01
     2.691655353764124e+01     2.810705059751608e+01];
 GlennMeteorTimes=[7.356885271256987e+05
     7.356885271261355e+05
     7.356885271263539e+05
     7.356885271265723e+05
     7.356885271267907e+05
     7.356885271276642e+05
     7.356885271278826e+05
     7.356885271281010e+05
     7.356885271285378e+05
     7.356885271287560e+05
     7.356885271289744e+05
     7.356885271291928e+05
     7.356885271294112e+05];
 qmeteor=[2.132832659064067e+14
     2.005915008213715e+14
     2.005915008213715e+14
     1.882890293132796e+14
     1.763758513821309e+14
     1.648519670279253e+14
     1.537173762506629e+14
     1.429720790503436e+14
     1.429720790503436e+14
     1.326160754269676e+14
     3.116260431716181e+14
     3.116260431716181e+14
     2.872918577566852e+14
     2.639467848140310e+14
     1.038838260184985e+14
     2.415908243436551e+14
     2.415908243436551e+14
     2.202239763455578e+14
     3.765392381376006e+14
     1.998462408197390e+14
     1.804576177661985e+14
     3.400082665107571e+14
     3.053409259195362e+14
     1.620581071849368e+14
     1.446477090759533e+14
     2.725372163639374e+14
     4.405987756429778e+14
     2.415971378439612e+14
     1.282264234392484e+14
     3.435727319024368e+14
     3.435727319024368e+14
     1.853078739108760e+14
     9.835118958267389e+13
     2.995789839326284e+14
     2.585980852297953e+14
     1.599586884977671e+14
     2.585980852297953e+14
     3.249031106361836e+14
     1.364731341202805e+14
     3.249031106361836e+14
     4.997202886136998e+14
     1.856748356250538e+14
     3.781093745426957e+14
     4.997202886136998e+14
     5.284579428836629e+14
     5.284579428836629e+14
     9.566775893185156e+14
     4.290123055469715e+14
     5.335122408896942e+14
     9.152862982651396e+14
     3.358914120954622e+14
     9.152862982651396e+14
     9.719608956696418e+14
     4.227228115103050e+14
     1.108856704905824e+15
     2.013727306319600e+14
     8.440811505682318e+14
     6.485771983732854e+14
     6.485771983732854e+14
     9.641422374587159e+14
     3.953622337049007e+14
     1.481884627554696e+15
     7.117459387885341e+14
     4.232392363189989e+15
     3.826492593386424e+15
     2.407461819208726e+15
     2.407461819208726e+15
     1.820687415141817e+15
     2.407461819208726e+15
     2.028250384734934e+15
     2.028250384734934e+15
     4.397181890413236e+14
     2.028250384734934e+15
     1.272837702557730e+15
     5.345635120075092e+15
     2.028250384734934e+15
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     1.087950525809015e+15
     9.507442914946034e+14
     2.307242942388130e+15
     4.033821072680275e+14
     8.227826563365574e+14
     2.307242942388130e+15
     2.307242942388130e+15
     1.976088861027439e+15
     2.306809288463282e+14
     1.976088861027439e+15
     8.892742945606295e+14
     1.976088861027439e+15
     7.949505279626201e+14
     1.379153927699971e+15
     1.976088861027439e+15
     1.904476075833615e+15
     1.976088861027439e+15
     1.040672472252840e+15
     1.976088861027439e+15
     8.414515760752784e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     7.794968914498959e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     7.794968914498959e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     3.241445513873251e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     9.073894878220269e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.896402681060382e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.896402681060382e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.591582806116436e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.740656532709970e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.976777913394417e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.976777913394417e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     1.896402681060382e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.142532694380145e+14
     2.403675656652884e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];
 radarTime=[7.356885271260998e+05
     7.356885271261345e+05
     7.356885271261692e+05
     7.356885271262040e+05
     7.356885271262387e+05
     7.356885271262734e+05
     7.356885271263081e+05
     7.356885271263429e+05
     7.356885271263776e+05
     7.356885271264123e+05
     7.356885271264471e+05
     7.356885271264818e+05
     7.356885271265164e+05
     7.356885271265511e+05
     7.356885271265859e+05
     7.356885271266206e+05
     7.356885271266553e+05
     7.356885271266900e+05
     7.356885271267248e+05
     7.356885271267595e+05
     7.356885271267942e+05
     7.356885271268289e+05
     7.356885271268637e+05
     7.356885271268984e+05
     7.356885271269331e+05
     7.356885271269678e+05
     7.356885271270026e+05
     7.356885271270373e+05
     7.356885271270720e+05
     7.356885271271067e+05
     7.356885271271415e+05
     7.356885271271762e+05
     7.356885271272109e+05
     7.356885271272457e+05
     7.356885271272804e+05
     7.356885271273151e+05
     7.356885271273497e+05
     7.356885271273846e+05
     7.356885271274192e+05
     7.356885271274539e+05
     7.356885271274886e+05
     7.356885271275234e+05
     7.356885271275581e+05
     7.356885271275928e+05
     7.356885271276275e+05
     7.356885271276623e+05
     7.356885271276970e+05
     7.356885271277317e+05
     7.356885271277664e+05
     7.356885271278012e+05
     7.356885271278359e+05
     7.356885271278706e+05
     7.356885271279053e+05
     7.356885271279401e+05
     7.356885271279748e+05
     7.356885271280095e+05
     7.356885271280443e+05
     7.356885271280790e+05
     7.356885271281137e+05
     7.356885271281484e+05
     7.356885271281832e+05
     7.356885271282179e+05
     7.356885271282526e+05
     7.356885271282872e+05
     7.356885271283220e+05
     7.356885271283567e+05
     7.356885271283914e+05
     7.356885271284262e+05
     7.356885271284609e+05
     7.356885271284956e+05
     7.356885271285303e+05
     7.356885271285651e+05
     7.356885271285998e+05
     7.356885271286345e+05
     7.356885271286692e+05
     7.356885271287040e+05
     7.356885271287387e+05
     7.356885271287734e+05
     7.356885271288081e+05
     7.356885271288429e+05
     7.356885271288776e+05
     7.356885271289123e+05
     7.356885271289470e+05
     7.356885271289818e+05
     7.356885271290165e+05
     7.356885271290512e+05
     7.356885271290859e+05
     7.356885271291207e+05
     7.356885271291554e+05
     7.356885271291900e+05
     7.356885271292249e+05
     7.356885271292595e+05
     7.356885271292942e+05
     7.356885271293289e+05
     7.356885271293637e+05
     7.356885271293984e+05
     7.356885271294331e+05
     7.356885271294678e+05
     7.356885271295026e+05
     7.356885271295373e+05
     7.356885271295720e+05
     7.356885271296067e+05
     7.356885271296415e+05
     7.356885271296762e+05
     7.356885271297109e+05
     7.356885271297456e+05
     7.356885271297804e+05
     7.356885271298151e+05
     7.356885271298498e+05
     7.356885271298845e+05
     7.356885271299193e+05
     7.356885271299540e+05
     7.356885271299887e+05
     7.356885271300233e+05
     7.356885271300582e+05
     7.356885271300928e+05
     7.356885271301275e+05
     7.356885271301622e+05
     7.356885271301970e+05
     7.356885271302317e+05
     7.356885271302664e+05
     7.356885271303012e+05
     7.356885271303359e+05
     7.356885271303706e+05
     7.356885271304053e+05
     7.356885271304401e+05
     7.356885271304748e+05
     7.356885271305095e+05
     7.356885271305442e+05
     7.356885271305790e+05
     7.356885271306137e+05
     7.356885271306484e+05
     7.356885271306831e+05
     7.356885271307179e+05
     7.356885271307526e+05
     7.356885271307873e+05
     7.356885271308220e+05
     7.356885271308568e+05
     7.356885271308915e+05
     7.356885271309261e+05
     7.356885271309610e+05
     7.356885271309956e+05
     7.356885271310303e+05
     7.356885271310650e+05
     7.356885271310998e+05
     7.356885271311345e+05
     7.356885271311692e+05
     7.356885271312039e+05
     7.356885271312387e+05
     7.356885271312734e+05
     7.356885271313081e+05
     7.356885271313428e+05
     7.356885271313776e+05
     7.356885271314123e+05
     7.356885271314470e+05
     7.356885271314818e+05
     7.356885271315165e+05
     7.356885271315512e+05
     7.356885271315859e+05
     7.356885271316207e+05
     7.356885271316554e+05
     7.356885271316901e+05
     7.356885271317248e+05
     7.356885271317596e+05
     7.356885271317943e+05
     7.356885271318289e+05
     7.356885271318636e+05
     7.356885271318984e+05
     7.356885271319331e+05
     7.356885271319678e+05
     7.356885271320025e+05
     7.356885271320373e+05
     7.356885271320720e+05
     7.356885271321067e+05
     7.356885271321415e+05
     7.356885271321762e+05
     7.356885271322109e+05
     7.356885271322456e+05];
 
   %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor28Day30032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all
 
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
P1=[7, AltitudeMeteor(1)];
P2=[7, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})


%%
%Meteor 13:= 2014/03/31 12:41:53.264, meteor 68, second day
meteorZ=[1.006356959468394e+02
     1.005067691457225e+02
     1.003774023385777e+02
     1.002476635604398e+02
     1.001175521835103e+02
     9.998706757911714e+01
     9.985620911759906e+01
     9.972497616839246e+01
     9.959343835370964e+01
     9.946145473446813e+01
     9.932909473095788e+01
     9.919635770894820e+01
     9.906324303339352e+01
     9.892975006843335e+01
     9.879587817715947e+01
     9.866169838566566e+01
     9.852706693031359e+01
     9.825666085322155e+01
     9.812088494948694e+01
     9.798472627942101e+01
     9.784818419991643e+01
     9.771133115742123e+01
     9.757402053059195e+01
     9.743632455941406e+01
     9.729824259679299e+01
     9.715977399496478e+01
     9.702091810517595e+01
     9.688167427768349e+01
     9.674211639640271e+01
     9.660209494834999e+01
     9.646168360830052e+01
     9.632088172281510e+01
     9.617968863758142e+01];
 
 MeteorSpeedAndAcc=[2.616223895876865e+01     2.530962322820494e+00
     2.620962111950583e+01     2.535116664033571e+00
     2.625709498820745e+01     2.539281437635768e+00
     2.630463539261680e+01     2.543454451064645e+00
     2.635224241338111e+01     2.547635725282790e+00
     2.639991613122724e+01     2.551825281316213e+00
     2.644765662699553e+01     2.556023140254545e+00
     2.649546398162857e+01     2.560229323251240e+00
     2.654331273895705e+01     2.564441602746713e+00
     2.659125401877851e+01     2.568664493111324e+00
     2.663926240083279e+01     2.572895771368212e+00
     2.668733796646324e+01     2.577135458928102e+00
     2.673548079712085e+01     2.581383577266553e+00
     2.678369097433058e+01     2.585640147924162e+00
     2.683196857975548e+01     2.589905192506768e+00
     2.688028790680923e+01     2.594176452412233e+00
     2.692870057793926e+01     2.598458505378392e+00
     2.702572902335340e+01     2.607048250552704e+00
     2.707434496185624e+01     2.611355986564798e+00
     2.712302882051745e+01     2.615672327506810e+00
     2.717178068170098e+01     2.619997295447024e+00
     2.722057458627954e+01     2.624328600182283e+00
     2.726946266361601e+01     2.628670883963389e+00
     2.731841899110901e+01     2.633021861337904e+00
     2.736744365152841e+01     2.637381554642944e+00
     2.741653672772362e+01     2.641749986283367e+00
     2.746569830268365e+01     2.646127178731993e+00
     2.751492845947066e+01     2.650513154529810e+00
     2.756420098426571e+01     2.654905591302218e+00
     2.761356851767337e+01     2.659309196982989e+00
     2.766300488268720e+01     2.663721654034940e+00
     2.771251016281235e+01     2.668142985273851e+00
     2.776208444162037e+01     2.672573213584747e+00];
 
 GlennMeteorTimes=[7.356895290887055e+05
     7.356895290889238e+05
     7.356895290891422e+05
     7.356895290893606e+05
     7.356895290895790e+05
     7.356895290897974e+05
     7.356895290900158e+05
     7.356895290902342e+05
     7.356895290904525e+05
     7.356895290906709e+05
     7.356895290908893e+05
     7.356895290911077e+05
     7.356895290913261e+05
     7.356895290915444e+05
     7.356895290917628e+05
     7.356895290919811e+05
     7.356895290921995e+05
     7.356895290926363e+05
     7.356895290928547e+05
     7.356895290930731e+05
     7.356895290932915e+05
     7.356895290935098e+05
     7.356895290937282e+05
     7.356895290939466e+05
     7.356895290941650e+05
     7.356895290943834e+05
     7.356895290946017e+05
     7.356895290948201e+05
     7.356895290950384e+05
     7.356895290952568e+05
     7.356895290954752e+05
     7.356895290956936e+05
     7.356895290959120e+05];
qmeteor=[5.909933727438019e+14
     5.909933727438019e+14
     5.909933727438019e+14
     8.078674600762235e+16
     1.501588905229093e+15
     1.501588905229093e+15
     1.501588905229093e+15
     5.909933727438019e+14
     1.501588905229093e+15
     8.078674600762235e+16
     8.078674600762235e+16
     8.078674600762235e+16
     8.078674600762235e+16
     8.078674600762235e+16
     8.078674600762235e+16
     3.904187950968795e+16
     2.829210797519244e+15
     2.829210797519244e+15
     3.904187950968795e+16
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     4.495679135983153e+16
     2.829210797519244e+15
     2.829210797519244e+15
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     4.495679135983153e+16
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     2.829210797519244e+15
     4.495679135983153e+16
     4.495679135983153e+16
     2.829210797519244e+15
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     1.169571842023425e+17
     1.169571842023425e+17
     4.495679135983153e+16
     4.495679135983153e+16
     1.169571842023425e+17
     1.169571842023425e+17
     4.495679135983153e+16
     1.169571842023425e+17
     1.169571842023425e+17
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     4.495679135983153e+16
     2.829210797519244e+15
     2.829210797519244e+15
     3.904187950968795e+16
     2.829210797519244e+15
     4.333983309676481e+16
     2.727452739645616e+15
     2.627558312807610e+15
     7.502865683360635e+16
     2.627558312807610e+15
     2.529527517005227e+15
     2.529527517005227e+15
     2.433360352238466e+15
     2.433360352238466e+15
     2.339056818507328e+15
     7.374946902982430e+16
     7.374946902982430e+16
     2.246616915811812e+15
     3.569924448124577e+16
     2.246616915811812e+15
     6.797904670584048e+16
     6.797904670584048e+16
     1.097223577786594e+15
     3.747710386159073e+16
     1.097223577786594e+15
     3.590268057361898e+16
     3.590268057361898e+16
     3.590268057361898e+16
     1.006023370648754e+15
     1.006023370648754e+15
     1.006023370648754e+15
     9.619069357882516e+14
     9.619069357882516e+14
     9.619069357882516e+14
     9.187796134000276e+14
     9.187796134000276e+14
     8.766414034840821e+14
     3.450273626341654e+14
     3.450273626341654e+14
     8.354923060404155e+14
     8.354923060404155e+14
     3.288319553566419e+14
     3.074027373853490e+16
     3.074027373853490e+16
     3.130258416560612e+14];
 radarTime=[ 7.356895290907538e+05
     7.356895290907884e+05
     7.356895290908231e+05
     7.356895290908578e+05
     7.356895290908926e+05
     7.356895290909273e+05
     7.356895290909620e+05
     7.356895290909967e+05
     7.356895290910315e+05
     7.356895290910662e+05
     7.356895290911009e+05
     7.356895290911357e+05
     7.356895290911704e+05
     7.356895290912051e+05
     7.356895290912398e+05
     7.356895290912746e+05
     7.356895290913093e+05
     7.356895290913440e+05
     7.356895290913787e+05
     7.356895290914135e+05
     7.356895290914482e+05
     7.356895290914829e+05
     7.356895290915176e+05
     7.356895290915524e+05
     7.356895290915871e+05
     7.356895290916217e+05
     7.356895290916564e+05
     7.356895290916912e+05
     7.356895290917259e+05
     7.356895290917606e+05
     7.356895290917954e+05
     7.356895290918301e+05
     7.356895290918648e+05
     7.356895290918995e+05
     7.356895290919343e+05
     7.356895290919690e+05
     7.356895290920037e+05
     7.356895290920384e+05
     7.356895290920732e+05
     7.356895290921079e+05
     7.356895290921426e+05
     7.356895290921773e+05
     7.356895290922121e+05
     7.356895290922468e+05
     7.356895290922815e+05
     7.356895290923162e+05
     7.356895290923510e+05
     7.356895290923857e+05
     7.356895290924204e+05
     7.356895290924550e+05
     7.356895290924899e+05
     7.356895290925245e+05
     7.356895290925592e+05
     7.356895290925940e+05
     7.356895290926287e+05
     7.356895290926634e+05
     7.356895290926981e+05
     7.356895290927329e+05
     7.356895290927676e+05
     7.356895290928023e+05
     7.356895290928370e+05
     7.356895290928718e+05
     7.356895290929065e+05
     7.356895290929412e+05
     7.356895290929759e+05
     7.356895290930107e+05
     7.356895290930454e+05
     7.356895290930801e+05
     7.356895290931148e+05
     7.356895290931496e+05
     7.356895290931843e+05
     7.356895290932190e+05
     7.356895290932538e+05
     7.356895290932885e+05
     7.356895290933232e+05
     7.356895290933579e+05
     7.356895290933927e+05
     7.356895290934274e+05
     7.356895290934620e+05
     7.356895290934967e+05
     7.356895290935315e+05
     7.356895290935662e+05
     7.356895290936009e+05
     7.356895290936356e+05
     7.356895290936704e+05
     7.356895290937051e+05
     7.356895290937398e+05
     7.356895290937746e+05
     7.356895290938093e+05
     7.356895290938440e+05
     7.356895290938787e+05
     7.356895290939135e+05
     7.356895290939482e+05
     7.356895290939829e+05
     7.356895290940176e+05
     7.356895290940524e+05
     7.356895290940871e+05
     7.356895290941218e+05
     7.356895290941565e+05
     7.356895290941913e+05
     7.356895290942260e+05
     7.356895290942607e+05
     7.356895290942953e+05
     7.356895290943302e+05
     7.356895290943648e+05
     7.356895290943995e+05
     7.356895290944342e+05
     7.356895290944690e+05
     7.356895290945037e+05
     7.356895290945384e+05
     7.356895290945732e+05
     7.356895290946079e+05
     7.356895290946426e+05
     7.356895290946773e+05
     7.356895290947121e+05
     7.356895290947468e+05
     7.356895290947815e+05
     7.356895290948162e+05
     7.356895290948510e+05
     7.356895290948857e+05
     7.356895290949204e+05
     7.356895290949551e+05
     7.356895290949899e+05
     7.356895290950246e+05
     7.356895290950593e+05
     7.356895290950940e+05
     7.356895290951288e+05];
 %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor68Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','StartPoint',meteorZ(1:4));
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all
 
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

P1=[8, AltitudeMeteor(1)];
P2=[8, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
%Meteor 18:= 2014/03/31 11:29:29.67, meteor 60, second day
meteorZ =[8.972686843026895e+01
     8.952483174082590e+01
     8.932291262870422e+01
     8.912121857888997e+01
     8.751113680773415e+01
     7.761680843005888e+01
     7.354684216208989e+01
     7.335426943661878e+01
     7.316180995170726e+01
     7.296946365549229e+01
     7.277723049593624e+01
     7.258511042123428e+01
     7.239320569828851e+01
     7.220131157711148e+01
     7.200953038502485e+01
     7.181786206999095e+01
     7.162630658049602e+01
     7.143486386456061e+01
     7.124353387037991e+01
     7.105231654609088e+01
     7.086131367838243e+01
     7.067032147879945e+01
     7.047944179415936e+01
     7.028867457259912e+01
     7.009801976243034e+01
     6.990747731213924e+01
     6.971704717003740e+01
     6.952683070336934e+01
     6.933662496303441e+01
     6.914653137611458e+01
     6.895654989109607e+01
     6.876668045658153e+01
     6.857692302088253e+01
     6.838727753254352e+01
     6.819784494116902e+01
     6.800842313369503e+01
     6.781911311950535e+01
     6.762991484691156e+01
     6.744082826480735e+01
     6.725185332173714e+01
     6.706298996630358e+01
     6.687433873151895e+01
     6.668569833814399e+01
     6.649716937867925e+01
     6.630875180184375e+01
     6.612044555635657e+01
     6.593225059105316e+01
     6.574416685482720e+01];
 MeteorSpeedAndAcc=[

     1.143954081297374e+01     1.338579328441471e+00
     1.142958672875607e+01     1.324947587432598e+00
     1.141959519389512e+01     1.311773524979973e+00
     1.140956975486283e+01     1.299075106793645e+00
     1.132770351485817e+01     1.215810659439784e+00
     1.071389098558666e+01     1.704119265686129e+00
     1.040602089478210e+01     2.423740783058066e+00
     1.039135648112035e+01     2.464753142578302e+00
     1.037674527199267e+01     2.506382318936595e+00
     1.036219638536663e+01     2.548630310544405e+00
     1.034771935488494e+01     2.591499332666439e+00
     1.033332414260189e+01     2.634991811398079e+00
     1.031902874967337e+01     2.679086693195985e+00
     1.030482878075397e+01     2.723833841728812e+00
     1.029074321132013e+01     2.769212931074463e+00
     1.027678384870756e+01     2.815227174132458e+00
     1.026296299564970e+01     2.861879967424213e+00
     1.024929346424860e+01     2.909174886258387e+00
     1.023578859010295e+01     2.957115680100050e+00
     1.022246224659285e+01     3.005706268142613e+00
     1.020933580598295e+01     3.054924310434747e+00
     1.019641025213583e+01     3.104826550454284e+00
     1.018370821169132e+01     3.155391316929150e+00
     1.017124585359993e+01     3.206623167543961e+00
     1.015903995726318e+01     3.258526810493420e+00
     1.014710792713047e+01     3.311107101192551e+00
     1.013546780723858e+01     3.364369039159329e+00
     1.012414424870900e+01     3.418288823869370e+00
     1.011314453074457e+01     3.472929246416374e+00
     1.010249482564250e+01     3.528267147791504e+00
     1.009221587840634e+01     3.584308075953030e+00
     1.008232914409878e+01     3.641057709781732e+00
     1.007285680113868e+01     3.698521856886878e+00
     1.006382176423283e+01     3.756706451546647e+00
     1.005525214015070e+01     3.815585955651797e+00
     1.004716320108438e+01     3.875229353180040e+00
     1.003958483836795e+01     3.935611739039663e+00
     1.003254303070202e+01     3.996739536044096e+00
     1.002606454963703e+01     4.058619285223630e+00
     1.002017696878628e+01     4.121257644469667e+00
     1.001490867217201e+01     4.184661387280250e+00
     1.001029114615589e+01     4.248802985682001e+00
     1.000634947778236e+01     4.313757855571392e+00
     1.000311716008712e+01     4.379499108221612e+00
     1.000062588134284e+01     4.446033968831138e+00
     9.998908165930656e+00     4.513369773307738e+00
     9.997997375677587e+00     4.581513967538034e+00
     9.997927709729288e+00     4.650474106731574e+00];
 GlennMeteorTimes=[7.356894788157321e+05
     7.356894788159505e+05
     7.356894788161688e+05
     7.356894788163871e+05
     7.356894788181342e+05
     7.356894788290531e+05
     7.356894788336391e+05
     7.356894788338575e+05
     7.356894788340759e+05
     7.356894788342942e+05
     7.356894788345126e+05
     7.356894788347310e+05
     7.356894788349493e+05
     7.356894788351677e+05
     7.356894788353861e+05
     7.356894788356045e+05
     7.356894788358229e+05
     7.356894788360413e+05
     7.356894788362597e+05
     7.356894788364781e+05
     7.356894788366964e+05
     7.356894788369148e+05
     7.356894788371332e+05
     7.356894788373515e+05
     7.356894788375699e+05
     7.356894788377883e+05
     7.356894788380067e+05
     7.356894788382250e+05
     7.356894788384434e+05
     7.356894788386618e+05
     7.356894788388802e+05
     7.356894788390986e+05
     7.356894788393170e+05
     7.356894788395354e+05
     7.356894788397537e+05
     7.356894788399721e+05
     7.356894788401905e+05
     7.356894788404088e+05
     7.356894788406272e+05
     7.356894788408456e+05
     7.356894788410640e+05
     7.356894788412823e+05
     7.356894788415007e+05
     7.356894788417191e+05
     7.356894788419375e+05
     7.356894788421559e+05
     7.356894788423743e+05
     7.356894788425927e+05];
 qmeteor=[2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];
 radarTime=[7.356894788214380e+05
     7.356894788214727e+05
     7.356894788215074e+05
     7.356894788215422e+05
     7.356894788215769e+05
     7.356894788216116e+05
     7.356894788216464e+05
     7.356894788216811e+05
     7.356894788217158e+05
     7.356894788217505e+05
     7.356894788217853e+05
     7.356894788218200e+05
     7.356894788218547e+05
     7.356894788218894e+05
     7.356894788219242e+05
     7.356894788219589e+05
     7.356894788219936e+05
     7.356894788220283e+05
     7.356894788220631e+05
     7.356894788220978e+05
     7.356894788221325e+05
     7.356894788221671e+05
     7.356894788222020e+05
     7.356894788222366e+05
     7.356894788222713e+05
     7.356894788223061e+05
     7.356894788223408e+05
     7.356894788223755e+05
     7.356894788224102e+05
     7.356894788224450e+05
     7.356894788224797e+05
     7.356894788225144e+05
     7.356894788225491e+05
     7.356894788225839e+05
     7.356894788226186e+05
     7.356894788226533e+05
     7.356894788226880e+05
     7.356894788227228e+05
     7.356894788227575e+05
     7.356894788227922e+05
     7.356894788228269e+05
     7.356894788228617e+05
     7.356894788228964e+05
     7.356894788229311e+05
     7.356894788229658e+05
     7.356894788230006e+05
     7.356894788230353e+05
     7.356894788230699e+05
     7.356894788231048e+05
     7.356894788231394e+05
     7.356894788231741e+05
     7.356894788232088e+05
     7.356894788232436e+05
     7.356894788232783e+05
     7.356894788233130e+05
     7.356894788233477e+05
     7.356894788233825e+05
     7.356894788234172e+05
     7.356894788234519e+05
     7.356894788234866e+05
     7.356894788235214e+05
     7.356894788235561e+05
     7.356894788235908e+05
     7.356894788236255e+05
     7.356894788236603e+05
     7.356894788236950e+05
     7.356894788237297e+05
     7.356894788237644e+05
     7.356894788237992e+05
     7.356894788238339e+05
     7.356894788238686e+05
     7.356894788239034e+05
     7.356894788239381e+05
     7.356894788239727e+05
     7.356894788240074e+05
     7.356894788240422e+05
     7.356894788240769e+05
     7.356894788241116e+05
     7.356894788241463e+05
     7.356894788241811e+05
     7.356894788242158e+05
     7.356894788242505e+05
     7.356894788242853e+05
     7.356894788243200e+05
     7.356894788243547e+05
     7.356894788243894e+05
     7.356894788244242e+05
     7.356894788244589e+05
     7.356894788244936e+05
     7.356894788245283e+05
     7.356894788245631e+05
     7.356894788245978e+05
     7.356894788246325e+05
     7.356894788246672e+05
     7.356894788247020e+05
     7.356894788247367e+05
     7.356894788247714e+05
     7.356894788248061e+05
     7.356894788248409e+05
     7.356894788248756e+05
     7.356894788249102e+05
     7.356894788249449e+05
     7.356894788249797e+05
     7.356894788250144e+05
     7.356894788250491e+05
     7.356894788250839e+05
     7.356894788251186e+05
     7.356894788251533e+05
     7.356894788251880e+05
     7.356894788252228e+05
     7.356894788252575e+05
     7.356894788252922e+05
     7.356894788253269e+05
     7.356894788253617e+05
     7.356894788253964e+05
     7.356894788254311e+05
     7.356894788254658e+05
     7.356894788255006e+05
     7.356894788255353e+05
     7.356894788255700e+05
     7.356894788256047e+05
     7.356894788256395e+05
     7.356894788256742e+05
     7.356894788257089e+05
     7.356894788257437e+05
     7.356894788257784e+05
     7.356894788258130e+05
     7.356894788258477e+05
     7.356894788258825e+05
     7.356894788259172e+05
     7.356894788259519e+05
     7.356894788259866e+05
     7.356894788260214e+05
     7.356894788260561e+05
     7.356894788260908e+05
     7.356894788261255e+05
     7.356894788261603e+05
     7.356894788261950e+05
     7.356894788262297e+05
     7.356894788262644e+05
     7.356894788262992e+05
     7.356894788263339e+05
     7.356894788263686e+05
     7.356894788264033e+05
     7.356894788264381e+05
     7.356894788264728e+05
     7.356894788265075e+05
     7.356894788265423e+05
     7.356894788265770e+05
     7.356894788266117e+05
     7.356894788266463e+05
     7.356894788266812e+05
     7.356894788267158e+05
     7.356894788267505e+05
     7.356894788267852e+05
     7.356894788268200e+05
     7.356894788268547e+05
     7.356894788268894e+05
     7.356894788269241e+05
     7.356894788269589e+05
     7.356894788269936e+05
     7.356894788270283e+05
     7.356894788270630e+05
     7.356894788270978e+05
     7.356894788271325e+05
     7.356894788271672e+05
     7.356894788272019e+05
     7.356894788272367e+05
     7.356894788272714e+05
     7.356894788273061e+05
     7.356894788273409e+05
     7.356894788273756e+05
     7.356894788274103e+05
     7.356894788274450e+05
     7.356894788274798e+05
     7.356894788275145e+05
     7.356894788275491e+05
     7.356894788275838e+05
     7.356894788276186e+05
     7.356894788276533e+05
     7.356894788276880e+05
     7.356894788277227e+05
     7.356894788277575e+05
     7.356894788277922e+05
     7.356894788278269e+05
     7.356894788278617e+05
     7.356894788278964e+05
     7.356894788279311e+05
     7.356894788279658e+05
     7.356894788280006e+05
     7.356894788280353e+05
     7.356894788280700e+05
     7.356894788281047e+05
     7.356894788281395e+05
     7.356894788281742e+05
     7.356894788282089e+05
     7.356894788282436e+05
     7.356894788282784e+05
     7.356894788283131e+05
     7.356894788283478e+05
     7.356894788283824e+05
     7.356894788284173e+05
     7.356894788284519e+05
     7.356894788284866e+05
     7.356894788285214e+05
     7.356894788285561e+05
     7.356894788285908e+05
     7.356894788286255e+05
     7.356894788286603e+05
     7.356894788286950e+05
     7.356894788287297e+05
     7.356894788287644e+05
     7.356894788287992e+05
     7.356894788288339e+05
     7.356894788288686e+05
     7.356894788289033e+05
     7.356894788289381e+05
     7.356894788289728e+05
     7.356894788290075e+05
     7.356894788290422e+05
     7.356894788290770e+05
     7.356894788291117e+05
     7.356894788291464e+05
     7.356894788291812e+05
     7.356894788292159e+05
     7.356894788292506e+05
     7.356894788292852e+05
     7.356894788293201e+05
     7.356894788293547e+05
     7.356894788293894e+05
     7.356894788294241e+05
     7.356894788294589e+05
     7.356894788294936e+05
     7.356894788295283e+05
     7.356894788295630e+05
     7.356894788295978e+05
     7.356894788296325e+05
     7.356894788296672e+05
     7.356894788297019e+05
     7.356894788297367e+05
     7.356894788297714e+05
     7.356894788298061e+05
     7.356894788298408e+05
     7.356894788298756e+05
     7.356894788299103e+05
     7.356894788299450e+05
     7.356894788299798e+05
     7.356894788300145e+05
     7.356894788300492e+05
     7.356894788300839e+05
     7.356894788301187e+05
     7.356894788301534e+05
     7.356894788301880e+05
     7.356894788302227e+05
     7.356894788302575e+05
     7.356894788302922e+05
     7.356894788303269e+05
     7.356894788303616e+05
     7.356894788303964e+05
     7.356894788304311e+05
     7.356894788304658e+05
     7.356894788305005e+05
     7.356894788305353e+05
     7.356894788305700e+05
     7.356894788306047e+05
     7.356894788306394e+05
     7.356894788306742e+05
     7.356894788307089e+05
     7.356894788307436e+05
     7.356894788307784e+05
     7.356894788308131e+05
     7.356894788308478e+05
     7.356894788308825e+05
     7.356894788309173e+05
     7.356894788309520e+05
     7.356894788309867e+05
     7.356894788310213e+05
     7.356894788310562e+05
     7.356894788310908e+05
     7.356894788311255e+05
     7.356894788311603e+05
     7.356894788311950e+05
     7.356894788312297e+05
     7.356894788312644e+05
     7.356894788312992e+05
     7.356894788313339e+05
     7.356894788313686e+05
     7.356894788314033e+05
     7.356894788314381e+05
     7.356894788314728e+05
     7.356894788315075e+05
     7.356894788315422e+05
     7.356894788315770e+05
     7.356894788316117e+05
     7.356894788316464e+05
     7.356894788316811e+05
     7.356894788317159e+05
     7.356894788317506e+05
     7.356894788317853e+05
     7.356894788318200e+05
     7.356894788318548e+05
     7.356894788318895e+05
     7.356894788319241e+05
     7.356894788319588e+05
     7.356894788319936e+05
     7.356894788320283e+05
     7.356894788320630e+05
     7.356894788320977e+05
     7.356894788321325e+05
     7.356894788321672e+05
     7.356894788322019e+05
     7.356894788322367e+05
     7.356894788322714e+05
     7.356894788323061e+05
     7.356894788323408e+05
     7.356894788323756e+05
     7.356894788324103e+05
     7.356894788324450e+05
     7.356894788324797e+05
     7.356894788325145e+05
     7.356894788325492e+05
     7.356894788325839e+05
     7.356894788326186e+05
     7.356894788326534e+05
     7.356894788326881e+05
     7.356894788327228e+05
     7.356894788327574e+05
     7.356894788327923e+05
     7.356894788328269e+05
     7.356894788328616e+05
     7.356894788328963e+05
     7.356894788329311e+05
     7.356894788329658e+05
     7.356894788330005e+05
     7.356894788330353e+05
     7.356894788330700e+05
     7.356894788331047e+05
     7.356894788331394e+05
     7.356894788331742e+05
     7.356894788332089e+05
     7.356894788332436e+05
     7.356894788332783e+05
     7.356894788333131e+05
     7.356894788333478e+05
     7.356894788333825e+05
     7.356894788334172e+05
     7.356894788334520e+05
     7.356894788334867e+05
     7.356894788335214e+05
     7.356894788335561e+05
     7.356894788335909e+05
     7.356894788336256e+05
     7.356894788336603e+05
     7.356894788336951e+05
     7.356894788337298e+05
     7.356894788337644e+05
     7.356894788337991e+05
     7.356894788338339e+05
     7.356894788338686e+05
     7.356894788339033e+05
     7.356894788339380e+05
     7.356894788339728e+05
     7.356894788340075e+05
     7.356894788340422e+05
     7.356894788340769e+05
     7.356894788341117e+05
     7.356894788341464e+05
     7.356894788341811e+05
     7.356894788342158e+05
     7.356894788342506e+05
     7.356894788342853e+05
     7.356894788343200e+05
     7.356894788343547e+05
     7.356894788343895e+05
     7.356894788344242e+05
     7.356894788344589e+05
     7.356894788344937e+05
     7.356894788345284e+05
     7.356894788345631e+05
     7.356894788345977e+05
     7.356894788346326e+05
     7.356894788346672e+05
     7.356894788347019e+05
     7.356894788347366e+05
     7.356894788347714e+05
     7.356894788348061e+05
     7.356894788348408e+05
     7.356894788348755e+05
     7.356894788349103e+05
     7.356894788349450e+05
     7.356894788349797e+05
     7.356894788350145e+05
     7.356894788350492e+05
     7.356894788350839e+05
     7.356894788351186e+05
     7.356894788351534e+05
     7.356894788351881e+05
     7.356894788352228e+05
     7.356894788352575e+05
     7.356894788352923e+05
     7.356894788353270e+05
     7.356894788353617e+05
     7.356894788353964e+05
     7.356894788354312e+05
     7.356894788354659e+05
     7.356894788355005e+05];

 
    %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor60Day31032014.mat');
% OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/AzDecImages/BandVmagMeteorHand60Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
% BmagMeteor=OpticalMeteor.BmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
% AbsoluteMagnitudeB=BmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2);
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
% BolometricPowerB=3819*10.^(-(100^(-1/5))*AbsoluteMagnitudeB); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));



figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all
BoloUncertainty=real(BoloUncertainty);
BoloUncertainty=BoloUncertainty((BoloUncertainty)~=0);
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

P1=[9, AltitudeMeteor(1)];
P2=[9, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})


%%
%Meteor 20:-2014/03/31 10:46:41.18, meteor 52 second day
meteorZ=[8.997156756840980e+01
     8.952074531312527e+01
     8.929536311327307e+01
     8.907000510811838e+01
     8.861924795373812e+01
     8.816823147847988e+01
     8.794266364444894e+01
     8.771680804390567e+01
     8.749074694667311e+01
     8.681092036510337e+01
     8.658361607422638e+01
     8.612779542883511e+01
     8.589905165949136e+01
     8.566971739177562e+01
     8.543973242312030e+01
     8.520903337002856e+01
     8.497755349623030e+01
     8.474534661504410e+01
     8.427783257699571e+01
     8.404248905509887e+01
     8.332906095042966e+01];
 
 MeteorSpeedAndAcc=[1.400404215857451e+01     1.907952901390422e+00
     1.396956666430598e+01     1.924015482173455e+00
     1.395591369761747e+01     1.932118932376520e+00
     1.394481295428359e+01     1.940269447958803e+00
     1.393082069117594e+01     1.956712818601400e+00
     1.392884697964593e+01     1.973347896493834e+00
     1.393283391132382e+01     1.981733566735160e+00
     1.394043343478159e+01     1.990172497920887e+00
     1.395189684209187e+01     1.998660525611788e+00
     1.401248268928284e+01     2.024422161641630e+00
     1.404261456215498e+01     2.033109557435512e+00
     1.412046984976549e+01     2.050631742484435e+00
     1.416935048694810e+01     2.059471814127872e+00
     1.422575964959087e+01     2.068363400712835e+00
     1.429049154822605e+01     2.077306812055026e+00
     1.436442638753606e+01     2.086302359664315e+00
     1.444844581468605e+01     2.095350356753715e+00
     1.454304519987085e+01     2.104446252984593e+00
     1.475511215817737e+01     2.122807280579303e+00
     1.484252461969205e+01     2.132068243515033e+00
     1.469737253080856e+01     6.407482126838740e+02];
 GlennMeteorTimes=[ 7.356894490878320e+05
     7.356894490882687e+05
     7.356894490884871e+05
     7.356894490887055e+05
     7.356894490891423e+05
     7.356894490895791e+05
     7.356894490897973e+05
     7.356894490900157e+05
     7.356894490902341e+05
     7.356894490908893e+05
     7.356894490911077e+05
     7.356894490915444e+05
     7.356894490917628e+05
     7.356894490919812e+05
     7.356894490921996e+05
     7.356894490924180e+05
     7.356894490926364e+05
     7.356894490928546e+05
     7.356894490932914e+05
     7.356894490935098e+05
     7.356894490941650e+05];
 
 qmeteor=[2.494059521622235e+14
     2.058821251167672e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];
 radarTime=[7.356894490928880e+05
     7.356894490929227e+05
     7.356894490929574e+05
     7.356894490929921e+05
     7.356894490930269e+05
     7.356894490930616e+05
     7.356894490930963e+05
     7.356894490931311e+05
     7.356894490931658e+05
     7.356894490932005e+05
     7.356894490932352e+05
     7.356894490932700e+05
     7.356894490933047e+05
     7.356894490933394e+05
     7.356894490933741e+05
     7.356894490934089e+05
     7.356894490934436e+05
     7.356894490934783e+05
     7.356894490935130e+05
     7.356894490935478e+05
     7.356894490935825e+05
     7.356894490936171e+05
     7.356894490936518e+05
     7.356894490936866e+05
     7.356894490937213e+05
     7.356894490937560e+05
     7.356894490937908e+05
     7.356894490938255e+05
     7.356894490938602e+05
     7.356894490938949e+05
     7.356894490939297e+05
     7.356894490939644e+05
     7.356894490939991e+05
     7.356894490940338e+05
     7.356894490940686e+05
     7.356894490941033e+05
     7.356894490941380e+05
     7.356894490941727e+05
     7.356894490942075e+05
     7.356894490942422e+05
     7.356894490942769e+05
     7.356894490943116e+05
     7.356894490943464e+05
     7.356894490943811e+05
     7.356894490944158e+05
     7.356894490944506e+05
     7.356894490944853e+05
     7.356894490945200e+05
     7.356894490945546e+05
     7.356894490945895e+05
     7.356894490946241e+05
     7.356894490946588e+05
     7.356894490946935e+05
     7.356894490947283e+05
     7.356894490947630e+05
     7.356894490947977e+05
     7.356894490948324e+05
     7.356894490948672e+05
     7.356894490949019e+05
     7.356894490949366e+05
     7.356894490949713e+05
     7.356894490950061e+05
     7.356894490950408e+05
     7.356894490950755e+05
     7.356894490951102e+05
     7.356894490951450e+05
     7.356894490951797e+05
     7.356894490952144e+05
     7.356894490952492e+05
     7.356894490952839e+05
     7.356894490953186e+05
     7.356894490953533e+05
     7.356894490953881e+05
     7.356894490954228e+05
     7.356894490954574e+05
     7.356894490954921e+05
     7.356894490955269e+05
     7.356894490955616e+05
     7.356894490955963e+05
     7.356894490956310e+05
     7.356894490956658e+05
     7.356894490957005e+05
     7.356894490957352e+05
     7.356894490957699e+05
     7.356894490958047e+05
     7.356894490958394e+05
     7.356894490958741e+05
     7.356894490959088e+05
     7.356894490959436e+05
     7.356894490959783e+05
     7.356894490960130e+05
     7.356894490960477e+05
     7.356894490960825e+05
     7.356894490961172e+05
     7.356894490961519e+05
     7.356894490961866e+05
     7.356894490962214e+05
     7.356894490962561e+05
     7.356894490962907e+05
     7.356894490963256e+05
     7.356894490963602e+05
     7.356894490963949e+05];
 
  %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor52Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on


%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all

AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];


P1=[10, AltitudeMeteor(1)];
P2=[10, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
 
%%
 % Meteor 24:= 2014/03/31 09:55:27.943
 
 meteorZ=[ 9.600789739748870e+01
     9.560476984327033e+01
     9.519897299114018e+01
     9.479049587668851e+01
     9.437932749702668e+01
     9.396545681062344e+01
     9.354887273722125e+01
     9.312978839747666e+01
     9.270774561493090e+01
     9.228295597689066e+01
     9.185540824688360e+01
     9.142509114907079e+01
     9.099199336810125e+01
     9.055610354904275e+01
     9.011764489097550e+01
     8.923180532336846e+01
     8.878463452090728e+01
     8.833461431273099e+01
     8.788173310341153e+01];
 
 MeteorSpeedAndAcc=[
     3.562403581675390e+01     1.122613389622236e+01
     3.558580352413337e+01     1.122824750314541e+01
     3.554968868651884e+01     1.123101923631496e+01
     3.551569438952692e+01     1.123445150385924e+01
     3.548382351589346e+01     1.123854668356957e+01
     3.545407874244333e+01     1.124330712223952e+01
     3.542646253723456e+01     1.124873513504098e+01
     3.540099017385402e+01     1.125482957563538e+01
     3.537763652361888e+01     1.126159919397845e+01
     3.535641756648666e+01     1.126904313540236e+01
     3.533733491070902e+01     1.127716358314535e+01
     3.532038994431879e+01     1.128596268629319e+01
     3.530558383341847e+01     1.129544255939654e+01
     3.529291752067684e+01     1.130560528213133e+01
     3.528239676453517e+01     1.131644693388866e+01
     3.526776617894824e+01     1.134020411632906e+01
     3.526366283511000e+01     1.135311795866357e+01
     3.526170061396961e+01     1.136672451606202e+01
     3.526187909817713e+01     1.138102565430145e+01];
 
 GlennMeteorTimes=[ 7.356894135178634e+05
     7.356894135180818e+05
     7.356894135183002e+05
     7.356894135185186e+05
     7.356894135187370e+05
     7.356894135189553e+05
     7.356894135191737e+05
     7.356894135193920e+05
     7.356894135196104e+05
     7.356894135198288e+05
     7.356894135200472e+05
     7.356894135202656e+05
     7.356894135204840e+05
     7.356894135207024e+05
     7.356894135209207e+05
     7.356894135213575e+05
     7.356894135215759e+05
     7.356894135217943e+05
     7.356894135220126e+05];
 
 qmeteor=[1.185815765426440e+15
     7.953781424013755e+14
     5.751729973250248e+14
     9.246824652791890e+14
     1.468716961487244e+15
     1.468716961487244e+15
     6.100644810567854e+14
     9.724093104879478e+15
     1.046659600585289e+16
     8.889351681285670e+14
     1.337554866518224e+16
     1.609256451071837e+15
     1.345571407160348e+15
     2.206300357939371e+14
     9.431571416910662e+14
     1.148011082376260e+15
     9.431571416910662e+14
     7.937294059800749e+14
     1.155454908978938e+15
     4.997202886136998e+14
     5.284579428836629e+14
     5.284579428836629e+14
     4.137514993700388e+14
     9.566775893185156e+14
     9.566775893185156e+14
     3.358914120954622e+14
     9.152862982651396e+14
     6.493912181236294e+14
     5.335122408896942e+14
     5.335122408896942e+14
     2.661400267899702e+14
     8.440811505682318e+14
     3.399233870827518e+14
     2.661400267899702e+14
     3.399233870827518e+14
     7.468377586887569e+14
     5.572444241041519e+14
     4.728394358813571e+14
     5.572444241041519e+14
     1.209157860414030e+15
     4.728394358813571e+14
     7.996261521072489e+14
     1.315740333089534e+15
     1.509633620862395e+14
     2.407461819208726e+15
     1.202289081641248e+15
     1.202289081641248e+15
     4.658748963497211e+15
     1.089183467511442e+15
     6.240286553365441e+14
     2.028250384734934e+15
     2.028250384734934e+15
     7.647789439008496e+14
     2.028250384734934e+15
     2.028250384734934e+15
     2.028250384734934e+15
     1.179222920597836e+15
     8.227826563365574e+14
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     2.307242942388130e+15
     1.555036823690443e+15
     1.087950525809015e+15
     2.307242942388130e+15
     1.976088861027439e+15
     1.976088861027439e+15
     1.976088861027439e+15
     1.976088861027439e+15
     1.976088861027439e+15
     5.822703429897235e+14
     5.822703429897235e+14
     5.822703429897235e+14
     1.976088861027439e+15
     7.949505279626201e+14];
 radarTime=[7.356894135194988e+05
     7.356894135195335e+05
     7.356894135195682e+05
     7.356894135196029e+05
     7.356894135196377e+05
     7.356894135196724e+05
     7.356894135197070e+05
     7.356894135197417e+05
     7.356894135197765e+05
     7.356894135198112e+05
     7.356894135198459e+05
     7.356894135198806e+05
     7.356894135199154e+05
     7.356894135199501e+05
     7.356894135199848e+05
     7.356894135200195e+05
     7.356894135200543e+05
     7.356894135200890e+05
     7.356894135201237e+05
     7.356894135201585e+05
     7.356894135201932e+05
     7.356894135202279e+05
     7.356894135202626e+05
     7.356894135202974e+05
     7.356894135203321e+05
     7.356894135203668e+05
     7.356894135204015e+05
     7.356894135204363e+05
     7.356894135204710e+05
     7.356894135205057e+05
     7.356894135205403e+05
     7.356894135205752e+05
     7.356894135206098e+05
     7.356894135206445e+05
     7.356894135206793e+05
     7.356894135207140e+05
     7.356894135207487e+05
     7.356894135207834e+05
     7.356894135208182e+05
     7.356894135208529e+05
     7.356894135208876e+05
     7.356894135209223e+05
     7.356894135209571e+05
     7.356894135209918e+05
     7.356894135210265e+05
     7.356894135210612e+05
     7.356894135210960e+05
     7.356894135211307e+05
     7.356894135211654e+05
     7.356894135212001e+05
     7.356894135212349e+05
     7.356894135212696e+05
     7.356894135213043e+05
     7.356894135213391e+05
     7.356894135213738e+05
     7.356894135214085e+05
     7.356894135214431e+05
     7.356894135214780e+05
     7.356894135215126e+05
     7.356894135215473e+05
     7.356894135215820e+05
     7.356894135216168e+05
     7.356894135216515e+05
     7.356894135216862e+05
     7.356894135217209e+05
     7.356894135217557e+05
     7.356894135217904e+05
     7.356894135218251e+05
     7.356894135218598e+05
     7.356894135218946e+05
     7.356894135219293e+05
     7.356894135219640e+05
     7.356894135219987e+05
     7.356894135220335e+05
     7.356894135220682e+05
     7.356894135221029e+05
     7.356894135221377e+05
     7.356894135221724e+05];
 
  %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor40Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on


%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all
 
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];


P1=[11, AltitudeMeteor(1)];
P2=[11, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
 
%%
% Meteor 27:= 2014/03/31  09:26:42.037, meteor 34, second day
meteorZ=[  8.796322006938863e+01
     8.763907944508537e+01
     8.699010028063276e+01
     8.666548067473923e+01
     8.634051578009166e+01
     8.601540071283671e+01
     8.569015717840011e+01
     8.536480655589185e+01
     8.503936990181319e+01
     8.471386795380386e+01
     8.406292310281424e+01
     8.373734656229135e+01
     8.308625626999492e+01
     8.211023471006411e+01
     8.178502735822985e+01
     8.145994532074110e+01
     8.113500606196612e+01
     8.081022676901557e+01
     8.048562435500207e+01
     8.016121546220529e+01
     7.983718922049229e+01
     7.951321610495143e+01
     7.918948483590793e+01
     7.886601100399639e+01
     7.854280994457440e+01
     7.821989674078577e+01];
 
 MeteorSpeedAndAcc=[1.743389143714581e+01     4.263868280250910e-01
     1.744832526105563e+01     4.274823114480933e-01
     1.747358905458628e+01     4.296398143933577e-01
     1.748444946415704e+01     4.306773500507831e-01
     1.749416214492987e+01     4.316581850171425e-01
     1.750273823988756e+01     4.325395835379311e-01
     1.751019458968424e+01     4.332508838792100e-01
     1.751654748780928e+01     4.336737601352353e-01
     1.752181244069989e+01     4.336102485312115e-01
     1.752600376328375e+01     4.327296313093801e-01
     1.753121144006666e+01     4.259526937112992e-01
     1.753224308510899e+01     4.176372932433314e-01
     1.753113612728831e+01     3.785783832248228e-01
     1.752085104539344e+01     2.289007036985974e-01
     1.751456775513686e+01     3.256377104261635e-01
     1.750628911668608e+01     6.875981807452850e-01
     1.749530846740138e+01     1.366810866652589e+00
     1.748046072593248e+01     2.530789756539917e+00
     1.745987107476163e+01     4.493632789517222e+00
     1.743064385340250e+01     7.790702085534000e+00
     1.738868246555800e+01     1.331879438235309e+01
     1.732914706712305e+01     2.259415074998062e+01
     1.725009339620134e+01     3.814840415223567e+01
     1.716568172177524e+01     6.423060719841638e+01
     1.714933501506739e+01     1.079656407727608e+02
     1.745979688604266e+01     1.813004465037570e+02];
 

GlennMeteorTimes=[7.356893935421035e+05
     7.356893935423219e+05
     7.356893935427587e+05
     7.356893935429769e+05
     7.356893935431953e+05
     7.356893935434137e+05
     7.356893935436321e+05
     7.356893935438505e+05
     7.356893935440689e+05
     7.356893935442873e+05
     7.356893935447240e+05
     7.356893935449424e+05
     7.356893935453792e+05
     7.356893935460342e+05
     7.356893935462526e+05
     7.356893935464710e+05
     7.356893935466894e+05
     7.356893935469078e+05
     7.356893935471262e+05
     7.356893935473446e+05
     7.356893935475629e+05
     7.356893935477813e+05
     7.356893935479997e+05
     7.356893935482181e+05
     7.356893935484365e+05
     7.356893935486549e+05];
 
 qmeteor=[2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14
     2.494059521622235e+14];
 
 radarTime=[7.356893935439913e+05
     7.356893935440260e+05
     7.356893935440606e+05
     7.356893935440955e+05
     7.356893935441301e+05
     7.356893935441648e+05
     7.356893935441995e+05
     7.356893935442343e+05
     7.356893935442690e+05
     7.356893935443037e+05
     7.356893935443384e+05
     7.356893935443732e+05
     7.356893935444079e+05
     7.356893935444426e+05
     7.356893935444773e+05
     7.356893935445121e+05
     7.356893935445468e+05
     7.356893935445815e+05
     7.356893935446162e+05
     7.356893935446510e+05
     7.356893935446857e+05
     7.356893935447204e+05
     7.356893935447552e+05
     7.356893935447899e+05
     7.356893935448246e+05
     7.356893935448593e+05
     7.356893935448941e+05
     7.356893935449288e+05
     7.356893935449634e+05
     7.356893935449981e+05
     7.356893935450329e+05
     7.356893935450676e+05
     7.356893935451023e+05
     7.356893935451370e+05
     7.356893935451718e+05
     7.356893935452065e+05
     7.356893935452412e+05
     7.356893935452759e+05
     7.356893935453107e+05
     7.356893935453454e+05
     7.356893935453801e+05
     7.356893935454149e+05
     7.356893935454496e+05
     7.356893935454843e+05
     7.356893935455190e+05
     7.356893935455538e+05
     7.356893935455885e+05
     7.356893935456232e+05
     7.356893935456579e+05
     7.356893935456927e+05
     7.356893935457274e+05
     7.356893935457621e+05
     7.356893935457967e+05
     7.356893935458316e+05
     7.356893935458662e+05
     7.356893935459009e+05
     7.356893935459356e+05
     7.356893935459704e+05];
 
%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor34Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
figure(7);errorbar(nanmean(BolometricPower),nanmean(qmeteorforratio),nanmean(BoloUncertainty),'horizontal');figure(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),50,nanmean(SpeedMeteor),'filled');set(gca,'xscale','log','yscale','log');hold on;xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power)');ylabel('Electron Line Density');title('q vs I','FontSize',15,'FontWeight','normal');colormap(jet); h=colorbar('FontSize',15);ylabel(h,'Speed','FontSize',15);hold on;
% %clear all
%%pause
%clear all
AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];AllMeteorBoloError=[AllMeteorBoloError;nanmean(BoloUncertainty)];
AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)]; 
AllMeteorQ(AllMeteorBoloPower>10)=AllMeteorQ(AllMeteorBoloPower>10)*3

figure(100);errorbar(AllMeteorBoloPower,AllMeteorQ,AllMeteorQError,AllMeteorQError,AllMeteorBoloError,AllMeteorBoloError,'.','LineWidth',2);hold on;scatter(AllMeteorBoloPower,AllMeteorQ,50,AllMeteorSpeed,'filled');set(gca,'xscale','log','yscale','log');xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);xlabel('Bolometric Power [W]','FontSize',20);ylabel('Electron Line Density [e/m]','FontSize',20);title('q vs I','FontSize',20,'FontWeight','normal');colormap(jet); h=colorbar('ylim',[10 70],'FontSize',15);ylabel(h,'Speed [km/s]','FontSize',15);hold on        
h2=plot(10.^x,10.^(x+13.19),'--c','LineWidth',3)
legend(h2,'Fit')
figure(200);scatter(log10(AllMeteorBoloPower),log10(AllMeteorQ),50,AllMeteorSpeed,'filled');hold on        

P1=[12, AltitudeMeteor(1)];
P2=[12, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
% Meteor 29 = 2014/03/31 09:07:20.9622, meteor 32 second day
meteorZ =[ 9.763959494253504e+01
     9.760292813876003e+01
     9.756377695225819e+01
     9.752211891987827e+01
     9.747793142271985e+01
     9.743119168480916e+01
     9.738187677253154e+01
     9.732999196185847e+01
     9.727545866704895e+01
     9.721828045236180e+01
     9.715843374305405e+01
     9.709589480144496e+01
     9.703063972618838e+01
     9.696264445105044e+01
     9.689192320304574e+01
     9.681837615820405e+01
     9.674201572888705e+01
     9.658075560428551e+01
     9.649580592682469e+01
     9.640794289830956e+01
     9.631719028623775e+01
     9.622342570303590e+01
     9.612667099354439e+01
     9.602690021009766e+01
     9.592408722781693e+01
     9.581820574303856e+01
     9.570922927261563e+01
     9.559719174282509e+01];
 
 MeteorSpeedAndAcc=[3.576095494799610e+01     1.396830588612469e+01
     3.552041942171142e+01     1.395428717911871e+01
     3.528183111622621e+01     1.394512529897639e+01
     3.504521075133667e+01     1.394115247412316e+01
     3.481057986366464e+01     1.394272170639032e+01
     3.457796082304103e+01     1.395020747346964e+01
     3.434737684864539e+01     1.396400636846917e+01
     3.411897328718488e+01     1.398452484813401e+01
     3.389253146287398e+01     1.401222702015671e+01
     3.366819960445861e+01     1.404756970789443e+01
     3.344600448670391e+01     1.409104262203365e+01
     3.322597381163397e+01     1.414315937669640e+01
     3.300813622298129e+01     1.420445747856807e+01
     3.279252132028492e+01     1.427549817081853e+01
     3.257927279872128e+01     1.435681989617154e+01
     3.236819472971685e+01     1.444911676926992e+01
     3.215943399347538e+01     1.455297822845027e+01
     3.174899973410347e+01     1.479802217242939e+01
     3.154739636715354e+01     1.494056918792132e+01
     3.134825066300242e+01     1.509740779852917e+01
     3.115170443897547e+01     1.526917068166015e+01
     3.095758673918548e+01     1.545678554645251e+01
     3.076604281765411e+01     1.566092493629895e+01
     3.057711348875885e+01     1.588236308357676e+01
     3.039084062146529e+01     1.612188734350298e+01
     3.020726713873821e+01     1.638029728511137e+01
     3.002643701494697e+01     1.665840393708298e+01
     2.984848942538557e+01     1.695686442636163e+01];
 GlennMeteorTimes=[ 7.356893801037299e+05
     7.356893801039483e+05
     7.356893801041667e+05
     7.356893801043851e+05
     7.356893801046035e+05
     7.356893801048219e+05
     7.356893801050403e+05
     7.356893801052585e+05
     7.356893801054769e+05
     7.356893801056953e+05
     7.356893801059137e+05
     7.356893801061321e+05
     7.356893801063505e+05
     7.356893801065689e+05
     7.356893801067872e+05
     7.356893801070056e+05
     7.356893801072240e+05
     7.356893801076608e+05
     7.356893801078792e+05
     7.356893801080976e+05
     7.356893801083158e+05
     7.356893801085342e+05
     7.356893801087526e+05
     7.356893801089710e+05
     7.356893801091894e+05
     7.356893801094078e+05
     7.356893801096262e+05
     7.356893801098445e+05];
 

 %From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor32Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on','StartPoint',meteorZ(1:4));
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));

figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

% %clear all
%%pause
%clear all
 
figure(6);semilogy([11.2:72],([11.2:72]*1000).^3*10^(-11.5),'.r')
P1=[13, AltitudeMeteor(1)];
P2=[13, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
% % Meteor 8 = 2014/03/30 12:23:29.434 , Meteor 21 first dau
% 
% meteorZ=[8.805806816813087e+01
%      8.770773196094142e+01
%      8.731033872845532e+01
%      8.691474449273845e+01
%      8.652094265408829e+01
%      8.457874119878447e+01
%      8.419552355269705e+01
%      8.193260462561314e+01
%      8.156137635433107e+01
% ];
% 
MeteorSpeedAndAcc=[22.3448568191987258e+00     1.782253794642880e+01
     2.134442925142994e+01     1.823818045315012e+01
     2.124847255882459e+01     1.867148686818027e+01
     2.115101360708030e+01     1.912909248420720e+01
     2.105254297885300e+01     1.962239995010798e+01
     2.052516865358796e+01     2.403087258579822e+01
     2.040748578461412e+01     2.607864590359972e+01
     1.980796787910277e+01     8.115495613906617e+01
     1.994366565647243e+01     1.061526290037075e+02];
% 
% GlennMeteorTimes=[7.356885163128930e+05
%      7.356885163131114e+05
%      7.356885163133298e+05
%      7.356885163135482e+05
%      7.356885163137666e+05
%      7.356885163148585e+05
%      7.356885163150768e+05
%      7.356885163163871e+05
%      7.356885163166055e+05];
% %From Optical Data:
% OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor21Day30032014.mat');
% VmagMeteor=OpticalMeteor.VmagMeteor;
% OpticalTime=OpticalMeteor.meteor_time;
% 
% %Find common times
% 
% %if there are holes in the radar data, we need to fit them 
% 
% % Fitting missing values
% time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
% time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% % fit range exponential
% fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
% tempZ = feval(fz,time_for_eval);
% % fit velocity exponential (using range)
% velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
% tempVel=feval(velFit,time_for_eval);
% % fit deceleration exponential (again using range)
% accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
% temAcc = feval(accFit,time_for_eval);
% 
% AltitudeMeteor=tempZ;
% SpeedMeteor=tempVel;
% 
% AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
% BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
% VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
% BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));
% 
% 
% figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
% figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
% figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
% figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
% figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on
% 
% %plotting mu*q*v^3/(2*I) Units: kg m s
% qmeteorforratio=zeros(length(BolometricPower),1);
% for iii=1:length(OpticalTime)
%     [~,ind]=min(radarTime-OpticalTime(iii));
%     if min(radarTime-OpticalTime(iii))<1e-3
%         qmeteorforratio(iii)=qmeteor(ind)*0.2;
%     else
%         qmeteorforratio(iii)=NaN;
%     end
% end
% SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
%  
% figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
% figue(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),35,nanmean(SpeedMeteor));set(gca,'xscale','log','yscale','log');hold on        
% % %clear all
% %%pause
% %clear all
% AllMeteorBoloPower=[AllMeteorBoloPower;nanmean(BolometricPower)];
% AllMeteorQ=[AllMeteorQ;nanmean(qmeteorforratio)];AllMeteorQError=[AllMeteorQError;0.25*nanmean(qmeteorforratio)];
% AllMeteorSpeed=[AllMeteorSpeed,nanmean(SpeedMeteor)];MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)]; 
% AllMeteorQ(AllMeteorBoloPower>10)=AllMeteorQ(AllMeteorBoloPower>10)*3
% 
%  
% 
MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];
P1=[17, 87.654];
P2=[17, 78.897];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(MeteorSpeedAndAcc(:,1))));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
% Meteor 11 = 2014/03/31 12:59:07.5849 , Meteor 73, day 2

meteorZ=[1.011082956256214e+02
     1.004250139445867e+02
     9.973872698667401e+01
     9.835526113845845e+01
     9.765842472705117e+01
     9.625448808030342e+01
     9.483716984333296e+01
     9.412313355292281e+01
     9.340562244903413e+01
     9.268462496253051e+01
     9.196012949073338e+01];

MeteorSpeedAndAcc=[4.984572232248917e+01     1.957422604717041e+01
     4.978419258781372e+01     1.945011123431409e+01
     4.972710551274853e+01     1.932890595076221e+01
     4.962594085340407e+01     1.909477955069943e+01
     4.958181106555271e+01     1.898186360638203e+01
     4.950624691335866e+01     1.876417791072420e+01
     4.944734404854267e+01     1.855721318576145e+01
     4.942402192386314e+01     1.845763089372706e+01
     4.940473623701567e+01     1.836062972449664e+01
     4.938944527038894e+01     1.826618166376738e+01
     4.937810739054148e+01     1.817425895108031e+01
];

GlennMeteorTimes=[7.356895410600106e+05
     7.356895410602289e+05
     7.356895410604472e+05
     7.356895410608840e+05
     7.356895410611024e+05
     7.356895410615392e+05
     7.356895410619759e+05
     7.356895410621943e+05
     7.356895410624127e+05
     7.356895410626311e+05
     7.356895410628495e+05];
%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor73Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
% figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
% figue(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),35,nanmean(SpeedMeteor));set(gca,'xscale','log','yscale','log');hold on        
% %clear all
%%pause
%clear all
MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];


 P1=[14, AltitudeMeteor(1)];
P2=[14, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})

%%
% Meteor 15 = 2014/03/30 12:22:37.9811 Meteor 66 day 2

meteorZ=[8.496697939013814e+01
     8.492811868617640e+01
     8.477036267191306e+01
     8.466533617224468e+01
     8.456043979547874e+01
     8.445570128591754e+01
     8.440336674639246e+01
     8.435106463693411e+01
     8.429879493744657e+01
     8.424655762784644e+01
     8.419435268806268e+01];

MeteorSpeedAndAcc=[ 1.317102048678190e+01     1.355601024125967e+00
     1.289024589843619e+01     2.523236534023258e+00
     1.287536994945860e+01     1.477380309535809e+00
     1.275646232281001e+01     1.062982440138637e+01
     1.253082418374820e+01     1.234014397899431e+01
     1.217899977120264e+01     1.474368736667416e+01
     1.194879716064964e+01     1.625308233733656e+01
     1.167836395940805e+01     1.799591254913946e+01
     1.136440000173695e+01     1.999656402791214e+01
     1.100340181541323e+01     2.228243238344742e+01
     1.059167387004279e+01     2.488444812860906e+01];

GlennMeteorTimes=[7.356895157173743e+05
     7.356895157175927e+05
     7.356895157182477e+05
     7.356895157186845e+05
     7.356895157191213e+05
     7.356895157195580e+05
     7.356895157197764e+05
     7.356895157199948e+05
     7.356895157202132e+05
     7.356895157204316e+05
     7.356895157206500e+05];
%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor66Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
% figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
% figue(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),35,nanmean(SpeedMeteor));set(gca,'xscale','log','yscale','log');hold on        
% %clear all
%%pause
%clear all
MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];

P1=[15, AltitudeMeteor(1)];
P2=[15, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
 
 


%%
% Meteor 26 = 2014/03/31 09:32:25.283; Meteor 35

meteorZ=[9.987915165270533e+01
     9.977439184098330e+01
     9.966723525724956e+01
     9.955766455865523e+01
     9.944566230257624e+01
     9.933127260977199e+01
     9.921435582865524e+01
     9.909495456769946e+01
     9.884862711621099e+01
     9.872166492407268e+01
     9.859214624787273e+01
     9.846012392926787e+01
     9.832543878837896e+01
     9.818814207994001e+01
     9.804821522904967e+01
     9.790563955462130e+01
     9.776039626881538e+01
     9.761246647656662e+01
     9.746191219503089e+01
     9.730855373018130e+01
     9.715245143467473e+01
     9.699358597878017e+01];

MeteorSpeedAndAcc=[2.715385944435113e+01     6.442221799807119e+00
     2.716483849984012e+01     6.553685527886548e+00
     2.717678385629621e+01     6.667458325459265e+00
     2.718971008567726e+01     6.783584900265368e+00
     2.720363184788463e+01     6.902110847078461e+00
     2.721855565667958e+01     7.023017522097546e+00
     2.723451225141680e+01     7.146481294963755e+00
     2.725150884971133e+01     7.272486704201913e+00
     2.728868206010052e+01     7.532320725242226e+00
     2.730888885295274e+01     7.666250957604046e+00
     2.733019600430864e+01     7.802926107766118e+00
     2.735260651650167e+01     7.942324449979088e+00
     2.737615960145986e+01     8.084649090494519e+00
     2.740085897577003e+01     8.229881957884908e+00
     2.742672006197735e+01     8.378079682992533e+00
     2.745375833132963e+01     8.529300026065316e+00
     2.748198930003666e+01     8.683601899499257e+00
     2.751142852546241e+01     8.841045391011312e+00
     2.754207492856339e+01     9.001605290603722e+00
     2.757397681993584e+01     9.165515343719511e+00
     2.760713383986557e+01     9.332754534044739e+00
     2.764156167123357e+01     9.503387890554224e+00];

GlennMeteorTimes=[7.356893975148498e+05
     7.356893975150682e+05
     7.356893975152866e+05
     7.356893975155050e+05
     7.356893975157234e+05
     7.356893975159416e+05
     7.356893975161600e+05
     7.356893975163784e+05
     7.356893975168152e+05
     7.356893975170336e+05
     7.356893975172520e+05
     7.356893975174703e+05
     7.356893975176887e+05
     7.356893975179071e+05
     7.356893975181255e+05
     7.356893975183439e+05
     7.356893975185623e+05
     7.356893975187807e+05
     7.356893975189989e+05
     7.356893975192173e+05
     7.356893975194357e+05
     7.356893975196541e+05];
%From Optical Data:
OpticalMeteor=load('/home/limo/PHD/PokerFlat2014/MatlabCode/Data/VmagMeteor35Day31032014.mat');
VmagMeteor=OpticalMeteor.VmagMeteor;
OpticalTime=OpticalMeteor.meteor_time;

%Find common times

%if there are holes in the radar data, we need to fit them 

% Fitting missing values
time_for_fit = (GlennMeteorTimes-GlennMeteorTimes(1))*86400;
time_for_eval=(OpticalTime-GlennMeteorTimes(1))*86400;
% fit range exponential
fz=fit(time_for_fit,meteorZ,'exp2','Robust','on');
tempZ = feval(fz,time_for_eval);
% fit velocity exponential (using range)
velFit=fit(time_for_fit,MeteorSpeedAndAcc(:,1),'exp2','Robust','on');
tempVel=feval(velFit,time_for_eval);
% fit deceleration exponential (again using range)
accFit = fit(time_for_fit,MeteorSpeedAndAcc(:,2),'exp2','Robust','on');
temAcc = feval(accFit,time_for_eval);

AltitudeMeteor=tempZ;
SpeedMeteor=tempVel;

AbsoluteMagnitude=VmagMeteor-100^(1/5)*log10((AltitudeMeteor./100).^2); %Meteor magnitude at 100 km
BolometricPower=1510*10.^(-(100^(-1/5))*AbsoluteMagnitude); % Meteor Bolometric Power
VmagUncertainity=sqrt(oosev+fittedmodel.fittedmodel(VmagMeteor).^2);
BoloUncertainty=sqrt(((1/(-100^(1/5)))*log(10)*1510*10.^(-1/(100^(1/5)).*VmagMeteor)).^2.*(VmagUncertainity.^2));


figure(1);plot(time_for_fit,meteorZ,'or',time_for_eval,AltitudeMeteor)
figure(2);plot(time_for_fit,MeteorSpeedAndAcc(:,1),'or',time_for_eval,SpeedMeteor)
figure(3);plot(time_for_eval,VmagMeteor,'or',time_for_eval,AbsoluteMagnitude);set(gca,'ydir','reverse');
figure(4); errorbar(time_for_eval,BolometricPower,BoloUncertainty);hold on
figure(5); errorbar(BolometricPower,AltitudeMeteor,BoloUncertainty,'o','horizontal');hold on

%plotting mu*q*v^3/(2*I) Units: kg m s
qmeteorforratio=zeros(length(BolometricPower),1);
for iii=1:length(OpticalTime)
    [~,ind]=min(radarTime-OpticalTime(iii));
    if min(radarTime-OpticalTime(iii))<1e-3
        qmeteorforratio(iii)=qmeteor(ind)*0.2;
    else
        qmeteorforratio(iii)=NaN;
    end
end
SpeedMeteorMs=SpeedMeteor*1000; %putting it m/s
 
% figure(6);semilogy(SpeedMeteor,mu*qmeteorforratio.*(SpeedMeteorMs).^3./(2*BolometricPower))
% figue(7);scatter(nanmean(BolometricPower),nanmean(qmeteorforratio),35,nanmean(SpeedMeteor));set(gca,'xscale','log','yscale','log');hold on        
% %clear all
%%pause
%clear all
MeteorSpeedForHist=[MeteorSpeedForHist,nanmean(SpeedMeteor)];


P1=[16, AltitudeMeteor(1)];
P2=[16, AltitudeMeteor(end)];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-mean(SpeedMeteor)));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'})
P1=[18, 96.2445];
P2=[18, 84.342];
D=-(P1-P2);[~,dummy_ind]=min(abs([10:72]-41));color_for_arrow=colorquiver(dummy_ind,:);
figure(8);plot(P1(1),P1(2),'o',P2(1),P2(2),'o','MarkerSize',15);hold on ; quiver(P1(1),P1(2),D(1),D(2),0,'LineWidth',3,'color',color_for_arrow);colormap(jet(62));h=colorbar('Ticks',[0,0.2,0.4,0.6,0.8,1],'TickLabels',{'10','22','34','46','58','70'},'FontSize',15);
xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);
yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);
ylabel(h,'Speed [km/s]','FontSize',20);hold on
xlabel('Event #','FontSize',20)
ylabel('Altitude [km]','FontSize',20)
title('Altitude of dual events','FontSize',20,'FontWeight','normal')
figure();hist([MeteorSpeedForHist,24]);
xAX = get(gca,'XAxis');set(xAX,'FontSize', 15);yAX = get(gca,'YAxis');set(yAX,'FontSize', 15);
xlabel('Speed [km/s]','FontSize',20)
ylabel('#','FontSize',20)
title('Velocity Distribution Dual Meteors','FontSize',20,'FontWeight','normal')